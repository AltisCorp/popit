//     Underscore.js 1.3.3
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore is freely distributable under the MIT license.
//     Portions of Underscore are inspired or borrowed from Prototype,
//     Oliver Steele's Functional, and John Resig's Micro-Templating.
//     For all details and documentation:
//     http://documentcloud.github.com/underscore

/*
 * Jeditable - jQuery in place edit plugin
 *
 * Copyright (c) 2006-2009 Mika Tuupola, Dylan Verheul
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/jeditable
 *
 * Based on editable by Dylan Verheul <dylan_at_dyve.net>:
 *    http://www.dyve.net/jquery/?editable
 *
 */

//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

// Backbone.Marionette v0.8.4
//
// Copyright (C)2012 Derick Bailey, Muted Solutions, LLC
// Distributed Under MIT License
//
// Documentation and Full License Available at:
// http://github.com/derickbailey/backbone.marionette

/**
 * Backbone Forms v0.9.0
 *
 * NOTE:
 * This version is for use with RequireJS
 * If using regular <script> tags to include your files, use backbone-forms.min.js
 *
 * Copyright (c) 2012 Charles Davison, Pow Media Ltd
 *
 * License and more information at:
 * http://github.com/powmedia/backbone-forms
 */

/*!
 * Jade - runtime
 * Copyright(c) 2010 TJ Holowaychuk <tj@vision-media.ca>
 * MIT Licensed
 */

/*!
 * fancyBox - jQuery Plugin
 * version: 2.0.6 (16/04/2012)
 * @requires jQuery v1.6 or later
 *
 * Examples at http://fancyapps.com/fancybox/
 * License: www.fancyapps.com/fancybox/#license
 *
 * Copyright 2012 Janis Skarnelis - janis@fancyapps.com
 *
 */

/*!
 * jQuery UI @VERSION
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */

/*!
 * jQuery UI Widget @VERSION
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */

/*!
 * jQuery UI Position @VERSION
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Position
 */

/*!
 * jQuery UI Autocomplete @VERSION
 *
 * Copyright 2012, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Autocomplete
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.position.js
 */

/*
 * jQuery UI Menu (not officially released)
 * 
 * This widget isn't yet finished and the API is subject to change. We plan to finish
 * it for the next release. You're welcome to give it a try anyway and give us feedback,
 * as long as you're okay with migrating your code later on. We can help with that, too.
 *
 * Copyright 2010, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Menu
 *
 * Depends:
 *	jquery.ui.core.js
 *  jquery.ui.widget.js
 */

/*
 RequireJS order 1.0.5 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

require.config({paths:{jquery:"https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min","jquery.mailcheck":"./libs/jquery.mailcheck.1.0.3.min","jquery.fancybox":"./libs/jquery.fancybox-2.0.6","jquery.jeditable":"./libs/jquery.jeditable-1.7.1","jquery.pulse":"./libs/jquery.pulse",jqueryui:"./libs/jqueryui-1.8.22",underscore:"./libs/underscore-1.3.3-amd",Backbone:"./libs/backbone-0.9.2-amd","backbone-forms":"./libs/backbone-forms-0.9.0-amd","Backbone.Marionette":"./libs/backbone.marionette-0.8.4",text:"./libs/requirejs/text-1.0.8.min",order:"./libs/requirejs/order-1.0.5.min"}}),define("require-config",function(){}),define("jquery.mailcheck",["jquery"],function(e){(function(e){e.fn.mailcheck=function(e,n){var r="yahoo.com,google.com,hotmail.com,gmail.com,me.com,aol.com,mac.com,live.com,comcast.net,googlemail.com,msn.com,hotmail.co.uk,yahoo.co.uk,facebook.com,verizon.net,sbcglobal.net,att.net,gmx.com,mail.com".split(","),i="co.uk,com,net,org,info,edu,gov,mil".split(",");if("object"==typeof e&&void 0===n)e.domains=e.domains||r;else{var s=e,e=n;e.domains=s||r}e.topLevelDomains=e.topLevelDomains||i,e.distanceFunction=t.sift3Distance,(r=t.mailcheck.suggest(encodeURI(this.val()),e.domains,e.topLevelDomains,e.distanceFunction))?e.suggested&&e.suggested(this,r):e.empty&&e.empty(this)}})(e);var t={mailcheck:{threshold:3,suggest:function(e,t,n,r){e=e.toLowerCase(),e=this.splitEmail(e);if(t=this.findClosestDomain(e.domain,t,r)){if(t!=e.domain)return{address:e.address,domain:t,full:e.address+"@"+t}}else if(n=this.findClosestDomain(e.topLevelDomain,n),e.domain&&n&&n!=e.topLevelDomain)return t=e.domain,t=t.substring(0,t.lastIndexOf(e.topLevelDomain))+n,{address:e.address,domain:t,full:e.address+"@"+t};return!1},findClosestDomain:function(e,t,n){var r,i=99,s=null;if(!e||!t)return!1;n||(n=this.sift3Distance);for(var o=0;o<t.length;o++){if(e===t[o])return e;r=n(e,t[o]),r<i&&(i=r,s=t[o])}return i<=this.threshold&&null!==s?s:!1},sift3Distance:function(e,t){if(null==e||0===e.length)return null==t||0===t.length?0:t.length;if(null==t||0===t.length)return e.length;for(var n=0,r=0,i=0,s=0;n+r<e.length&&n+i<t.length;){if(e.charAt(n+r)==t.charAt(n+i))s++;else for(var o=i=r=0;5>o;o++){if(n+o<e.length&&e.charAt(n+o)==t.charAt(n)){r=o;break}if(n+o<t.length&&e.charAt(n)==t.charAt(n+o)){i=o;break}}n++}return(e.length+t.length)/2-s},splitEmail:function(e){e=e.split("@");if(2>e.length)return!1;for(var t=0;t<e.length;t++)if(""===e[t])return!1;var n=e.pop(),r=n.split("."),i="";if(0==r.length)return!1;if(1==r.length)i=r[0];else{for(t=1;t<r.length;t++)i+=r[t]+".";2<=r.length&&(i=i.substring(0,i.length-1))}return{topLevelDomain:i,domain:n,address:e.join("@")}}}}}),require(["jquery","jquery.mailcheck"],function(e){var t=["yahoo.com","google.com","hotmail.com","gmail.com","me.com","aol.com","mac.com","live.com","comcast.net","googlemail.com","msn.com","hotmail.co.uk","yahoo.co.uk","facebook.com","verizon.net","sbcglobal.net","att.net","gmx.com","mail.com","mysociety.org"];e(document).on("change","input[type=email]",function(){var n=e(this),r=n.next(".suggestion");r.length||(r=e('<div class="suggestion" />'),n.after(r).hide()),n.mailcheck({domains:t,suggested:function(e,t){var n="Did you mean <strong>"+t.full+"</strong>?";r.html(n).slideDown()},empty:function(e){r.slideUp()}})})}),define("augmenters/mailchecker",function(){}),function(){function C(e,t,n){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e._chain&&(e=e._wrapped),t._chain&&(t=t._wrapped);if(e.isEqual&&S.isFunction(e.isEqual))return e.isEqual(t);if(t.isEqual&&S.isFunction(t.isEqual))return t.isEqual(e);var r=a.call(e);if(r!=a.call(t))return!1;switch(r){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var i=n.length;while(i--)if(n[i]==e)return!0;n.push(e);var s=0,o=!0;if(r=="[object Array]"){s=e.length,o=s==t.length;if(o)while(s--)if(!(o=s in e==s in t&&C(e[s],t[s],n)))break}else{if("constructor"in e!="constructor"in t||e.constructor!=t.constructor)return!1;for(var u in e)if(S.has(e,u)){s++;if(!(o=S.has(t,u)&&C(e[u],t[u],n)))break}if(o){for(u in t)if(S.has(t,u)&&!(s--))break;o=!s}}return n.pop(),o}var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.slice,u=r.unshift,a=i.toString,f=i.hasOwnProperty,l=r.forEach,c=r.map,h=r.reduce,p=r.reduceRight,d=r.filter,v=r.every,m=r.some,g=r.indexOf,y=r.lastIndexOf,b=Array.isArray,w=Object.keys,E=s.bind,S=function(e){return new P(e)};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=S),exports._=S):e._=S,S.VERSION="1.3.3";var x=S.each=S.forEach=function(e,t,r){if(e==null)return;if(l&&e.forEach===l)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(i in e&&t.call(r,e[i],i,e)===n)return}else for(var o in e)if(S.has(e,o)&&t.call(r,e[o],o,e)===n)return};S.map=S.collect=function(e,t,n){var r=[];return e==null?r:c&&e.map===c?e.map(t,n):(x(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},S.reduce=S.foldl=S.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(h&&e.reduce===h)return r&&(t=S.bind(t,r)),i?e.reduce(t,n):e.reduce(t);x(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},S.reduceRight=S.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduceRight===p)return r&&(t=S.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=S.toArray(e).reverse();return r&&!i&&(t=S.bind(t,r)),i?S.reduce(s,t,n,r):S.reduce(s,t)},S.find=S.detect=function(e,t,n){var r;return T(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},S.filter=S.select=function(e,t,n){var r=[];return e==null?r:d&&e.filter===d?e.filter(t,n):(x(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},S.reject=function(e,t,n){var r=[];return e==null?r:(x(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},S.every=S.all=function(e,t,r){var i=!0;return e==null?i:v&&e.every===v?e.every(t,r):(x(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var T=S.some=S.any=function(e,t,r){t||(t=S.identity);var i=!1;return e==null?i:m&&e.some===m?e.some(t,r):(x(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};S.include=S.contains=function(e,t){var n=!1;return e==null?n:g&&e.indexOf===g?e.indexOf(t)!=-1:(n=T(e,function(e){return e===t}),n)},S.invoke=function(e,t){var n=o.call(arguments,2);return S.map(e,function(e){return(S.isFunction(t)?t||e:e[t]).apply(e,n)})},S.pluck=function(e,t){return S.map(e,function(e){return e[t]})},S.max=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&S.isEmpty(e))return-Infinity;var r={computed:-Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},S.min=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&S.isEmpty(e))return Infinity;var r={computed:Infinity};return x(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},S.shuffle=function(e){var t=[],n;return x(e,function(e,r,i){n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e}),t},S.sortBy=function(e,t,n){var r=S.isFunction(t)?t:function(e){return e[t]};return S.pluck(S.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n===void 0?1:r===void 0?-1:n<r?-1:n>r?1:0}),"value")},S.groupBy=function(e,t){var n={},r=S.isFunction(t)?t:function(e){return e[t]};return x(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},S.sortedIndex=function(e,t,n){n||(n=S.identity);var r=0,i=e.length;while(r<i){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},S.toArray=function(e){return e?S.isArray(e)?o.call(e):S.isArguments(e)?o.call(e):e.toArray&&S.isFunction(e.toArray)?e.toArray():S.values(e):[]},S.size=function(e){return S.isArray(e)?e.length:S.keys(e).length},S.first=S.head=S.take=function(e,t,n){return t!=null&&!n?o.call(e,0,t):e[0]},S.initial=function(e,t,n){return o.call(e,0,e.length-(t==null||n?1:t))},S.last=function(e,t,n){return t!=null&&!n?o.call(e,Math.max(e.length-t,0)):e[e.length-1]},S.rest=S.tail=function(e,t,n){return o.call(e,t==null||n?1:t)},S.compact=function(e){return S.filter(e,function(e){return!!e})},S.flatten=function(e,t){return S.reduce(e,function(e,n){return S.isArray(n)?e.concat(t?n:S.flatten(n)):(e[e.length]=n,e)},[])},S.without=function(e){return S.difference(e,o.call(arguments,1))},S.uniq=S.unique=function(e,t,n){var r=n?S.map(e,n):e,i=[];return e.length<3&&(t=!0),S.reduce(r,function(n,r,s){if(t?S.last(n)!==r||!n.length:!S.include(n,r))n.push(r),i.push(e[s]);return n},[]),i},S.union=function(){return S.uniq(S.flatten(arguments,!0))},S.intersection=S.intersect=function(e){var t=o.call(arguments,1);return S.filter(S.uniq(e),function(e){return S.every(t,function(t){return S.indexOf(t,e)>=0})})},S.difference=function(e){var t=S.flatten(o.call(arguments,1),!0);return S.filter(e,function(e){return!S.include(t,e)})},S.zip=function(){var e=o.call(arguments),t=S.max(S.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=S.pluck(e,""+r);return n},S.indexOf=function(e,t,n){if(e==null)return-1;var r,i;if(n)return r=S.sortedIndex(e,t),e[r]===t?r:-1;if(g&&e.indexOf===g)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(r in e&&e[r]===t)return r;return-1},S.lastIndexOf=function(e,t){if(e==null)return-1;if(y&&e.lastIndexOf===y)return e.lastIndexOf(t);var n=e.length;while(n--)if(n in e&&e[n]===t)return n;return-1},S.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var N=function(){};S.bind=function(t,n){var r,i;if(t.bind===E&&E)return E.apply(t,o.call(arguments,1));if(!S.isFunction(t))throw new TypeError;return i=o.call(arguments,2),r=function(){if(this instanceof r){N.prototype=t.prototype;var e=new N,s=t.apply(e,i.concat(o.call(arguments)));return Object(s)===s?s:e}return t.apply(n,i.concat(o.call(arguments)))}},S.bindAll=function(e){var t=o.call(arguments,1);return t.length==0&&(t=S.functions(e)),x(t,function(t){e[t]=S.bind(e[t],e)}),e},S.memoize=function(e,t){var n={};return t||(t=S.identity),function(){var r=t.apply(this,arguments);return S.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},S.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},S.defer=function(e){return S.delay.apply(S,[e,1].concat(o.call(arguments,1)))},S.throttle=function(e,t){var n,r,i,s,o,u,a=S.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var f=function(){i=null,o&&e.apply(n,r),a()};return i||(i=setTimeout(f,t)),s?o=!0:u=e.apply(n,r),a(),s=!0,u}},S.debounce=function(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,n||e.apply(i,s)};n&&!r&&e.apply(i,s),clearTimeout(r),r=setTimeout(o,t)}},S.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},S.wrap=function(e,t){return function(){var n=[e].concat(o.call(arguments,0));return t.apply(this,n)}},S.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},S.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},S.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)S.has(e,n)&&(t[t.length]=n);return t},S.values=function(e){return S.map(e,S.identity)},S.functions=S.methods=function(e){var t=[];for(var n in e)S.isFunction(e[n])&&t.push(n);return t.sort()},S.extend=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},S.pick=function(e){var t={};return x(S.flatten(o.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},S.defaults=function(e){return x(o.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},S.clone=function(e){return S.isObject(e)?S.isArray(e)?e.slice():S.extend({},e):e},S.tap=function(e,t){return t(e),e},S.isEqual=function(e,t){return C(e,t,[])},S.isEmpty=function(e){if(e==null)return!0;if(S.isArray(e)||S.isString(e))return e.length===0;for(var t in e)if(S.has(e,t))return!1;return!0},S.isElement=function(e){return!!e&&e.nodeType==1},S.isArray=b||function(e){return a.call(e)=="[object Array]"},S.isObject=function(e){return e===Object(e)},S.isArguments=function(e){return a.call(e)=="[object Arguments]"},S.isArguments(arguments)||(S.isArguments=function(e){return!!e&&!!S.has(e,"callee")}),S.isFunction=function(e){return a.call(e)=="[object Function]"},S.isString=function(e){return a.call(e)=="[object String]"},S.isNumber=function(e){return a.call(e)=="[object Number]"},S.isFinite=function(e){return S.isNumber(e)&&isFinite(e)},S.isNaN=function(e){return e!==e},S.isBoolean=function(e){return e===!0||e===!1||a.call(e)=="[object Boolean]"},S.isDate=function(e){return a.call(e)=="[object Date]"},S.isRegExp=function(e){return a.call(e)=="[object RegExp]"},S.isNull=function(e){return e===null},S.isUndefined=function(e){return e===void 0},S.has=function(e,t){return f.call(e,t)},S.noConflict=function(){return e._=t,this},S.identity=function(e){return e},S.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},S.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},S.result=function(e,t){if(e==null)return null;var n=e[t];return S.isFunction(n)?n.call(e):n},S.mixin=function(e){x(S.functions(e),function(t){B(t,S[t]=e[t])})};var k=0;S.uniqueId=function(e){var t=k++;return e?e+t:t},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/.^/,A={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var O in A)A[A[O]]=O;var M=/\\|'|\r|\n|\t|\u2028|\u2029/g,_=/\\(\\|'|r|n|t|u2028|u2029)/g,D=function(e){return e.replace(_,function(e,t){return A[t]})};S.template=function(e,t,n){n=S.defaults(n||{},S.templateSettings);var r="__p+='"+e.replace(M,function(e){return"\\"+A[e]}).replace(n.escape||L,function(e,t){return"'+\n_.escape("+D(t)+")+\n'"}).replace(n.interpolate||L,function(e,t){return"'+\n("+D(t)+")+\n'"}).replace(n.evaluate||L,function(e,t){return"';\n"+D(t)+"\n;__p+='"})+"';\n";n.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+r+"return __p;\n";var i=new Function(n.variable||"obj","_",r);if(t)return i(t,S);var s=function(e){return i.call(this,e,S)};return s.source="function("+(n.variable||"obj")+"){\n"+r+"}",s},S.chain=function(e){return S(e).chain()};var P=function(e){this._wrapped=e};S.prototype=P.prototype;var H=function(e,t){return t?S(e).chain():e},B=function(e,t){P.prototype[e]=function(){var e=o.call(arguments);return u.call(e,this._wrapped),H(t.apply(S,e),this._chain)}};S.mixin(S),x(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];P.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var r=n.length;return(e=="shift"||e=="splice")&&r===0&&delete n[0],H(n,this._chain)}}),x(["concat","join","slice"],function(e){var t=r[e];P.prototype[e]=function(){return H(t.apply(this._wrapped,arguments),this._chain)}}),P.prototype.chain=function(){return this._chain=!0,this},P.prototype.value=function(){return this._wrapped},typeof define=="function"&&define.amd&&define("underscore",[],function(){return S})}.call(this),require(["jquery","underscore"],function($,_){$(function(){var myTimer,getUpdate=function(){$.getJSON("/migration/progress/"+id,function(e){var t="Imported "+e.progress+" of "+e.total+" items.";e.total===e.progress&&e.count>=0&&(t='Finished importing <a href="/person" id="_finished">'+e.count+"</a> people.",clearInterval(myTimer)),e.err&&e.err.name&&(t="An error occured: <br><pre>"+e.err.name+"\n\n"+e.err.err+"</pre>",$(".progress").addClass("error")),$(".progress").html(t)})};if($(".progress").html()){var arr=window.location.pathname.split("/"),id=arr[arr.length-1];getUpdate(),myTimer=window.setInterval(function(){getUpdate()},2e3)}$(".history-back").click(function(e){e.preventDefault(),window.history.back()}),$("form.migration-form select").change(function(){var suggestions,tr=$(this).parents("tr"),td=$(this).parents("td").next(),option=$(this).find(":selected"),s=option.filter("option[data-suggestions]").attr("data-suggestions"),id=tr.attr("id"),attr=option.attr("data-strict"),isStrict=typeof attr!="undefined"&&attr!==!1;tr.find("datalist").remove(),tr.find("select[name=db-attribute]").remove(),tr.find(".suggestions").html(""),td.find("input").show().attr("name","db-attribute");if(!s)return;var arr=eval(s),cb="<select>";$.each(arr,function(e,t){cb+="<option>"+t,"<option>"}),cb+="</select>";if(isStrict)td.append(cb).find("select").attr("name","db-attribute"),td.find("input").attr("name","").hide();else{var dl='<datalist id="'+id+'"><select>'+cb+"</select></datalist>";tr.append(dl),tr.find("input[name=db-attribute]").attr("list",id),suggestions=arr.join(", "),tr.find(".suggestions").html(suggestions||"").append(",...")}}),$("form.migration-form").submit(function(){var e=_.zip($("form.migration-form [name=db-attribute-class]").map(function(e,t){return $(t).val()}),$("form.migration-form [name=db-attribute]").map(function(e,t){return $(t).val()})),t=e.filter(function(e){return e[0]==="name"&&(e[1]==="First name"||e[1]==="Full name")});return t.length==0?(alert("You have to provide a column for 'First name'!"),!1):!0}),$("select").change()})}),define("augmenters/migration",function(){}),define("utils/slugify",[],function(){return function(e){return e.replace(/[^a-z0-9\-]+/gi,"-").replace(/-+/g,"-").replace(/-$/,"").replace(/^-/,"").toLowerCase()}}),require(["jquery","utils/slugify"],function(e,t){var n=function(t){return t>=97&&t<=122||t>=65&&t<=90||t>=48&&t<=57||t===45||t===32||e.inArray(t,[13,37,39,9,20,46,8])>=0?!0:!1};e(document).on({keypress:function(e){return n(e.which)},change:function(n){var r=e(this).val(),i=t(r);e(this).val(i)}},"input[name=slug]")}),define("augmenters/slug-validation",function(){}),define("jquery.jeditable",["jquery"],function($){return $.fn.editable=function(e,t){if("disable"==e){$(this).data("disabled.editable",!0);return}if("enable"==e){$(this).data("disabled.editable",!1);return}if("destroy"==e){$(this).unbind($(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");return}var n=$.extend({},$.fn.editable.defaults,{target:e},t),r=$.editable.types[n.type].plugin||function(){},i=$.editable.types[n.type].submit||function(){},s=$.editable.types[n.type].buttons||$.editable.types.defaults.buttons,o=$.editable.types[n.type].content||$.editable.types.defaults.content,u=$.editable.types[n.type].element||$.editable.types.defaults.element,a=$.editable.types[n.type].reset||$.editable.types.defaults.reset,f=n.callback||function(){},l=n.onedit||function(){},c=n.onsubmit||function(){},h=n.onreset||function(){},p=n.onerror||a;return n.tooltip&&$(this).attr("title",n.tooltip),n.autowidth="auto"==n.width,n.autoheight="auto"==n.height,this.each(function(){var e=this,t=$(e).width(),d=$(e).height();$(this).data("event.editable",n.event),$.trim($(this).html())||$(this).html(n.placeholder),$(this).bind(n.event,function(h){if(!0===$(this).data("disabled.editable"))return;if(e.editing)return;if(!1===l.apply(this,[n,e]))return;h.preventDefault(),h.stopPropagation(),n.tooltip&&$(e).removeAttr("title"),0==$(e).width()?(n.width=t,n.height=d):(n.width!="none"&&(n.width=n.autowidth?$(e).width():n.width),n.height!="none"&&(n.height=n.autoheight?$(e).height():n.height)),$(this).html().toLowerCase().replace(/(;|")/g,"")==n.placeholder.toLowerCase().replace(/(;|")/g,"")&&$(this).html(""),e.editing=!0,e.revert=$(e).html(),$(e).html("");var v=$("<form />");n.cssclass&&("inherit"==n.cssclass?v.attr("class",$(e).attr("class")):v.attr("class",n.cssclass)),n.style&&("inherit"==n.style?(v.attr("style",$(e).attr("style")),v.css("display",$(e).css("display"))):v.attr("style",n.style));var m=u.apply(v,[n,e]),g;if(n.loadurl){var y=setTimeout(function(){m.disabled=!0,o.apply(v,[n.loadtext,n,e])},100),b={};b[n.id]=e.id,$.isFunction(n.loaddata)?$.extend(b,n.loaddata.apply(e,[e.revert,n])):$.extend(b,n.loaddata),$.ajax({type:n.loadtype,url:n.loadurl,data:b,async:!1,success:function(e){window.clearTimeout(y),g=e,m.disabled=!1}})}else n.data?(g=n.data,$.isFunction(n.data)&&(g=n.data.apply(e,[e.revert,n]))):g=e.revert;o.apply(v,[g,n,e]),m.attr("name",n.name),s.apply(v,[n,e]),$(e).append(v),r.apply(v,[n,e]),$(":input:visible:enabled:first",v).focus(),n.select&&m.select(),m.keydown(function(t){t.keyCode==27&&(t.preventDefault(),a.apply(v,[n,e]))});var y;"cancel"==n.onblur?m.blur(function(t){y=setTimeout(function(){a.apply(v,[n,e])},500)}):"submit"==n.onblur?m.blur(function(e){y=setTimeout(function(){v.submit()},200)}):$.isFunction(n.onblur)?m.blur(function(t){n.onblur.apply(e,[m.val(),n])}):m.blur(function(e){}),v.submit(function(t){y&&clearTimeout(y),t.preventDefault();if(!1!==c.apply(v,[n,e])&&!1!==i.apply(v,[n,e]))if($.isFunction(n.target)){var r=n.target.apply(e,[m.val(),n]);$(e).html(r),e.editing=!1,f.apply(e,[e.innerHTML,n]),$.trim($(e).html())||$(e).html(n.placeholder)}else{var s={};s[n.name]=m.val(),s[n.id]=e.id,$.isFunction(n.submitdata)?$.extend(s,n.submitdata.apply(e,[e.revert,n])):$.extend(s,n.submitdata),"PUT"==n.method&&(s._method="put"),$(e).html(n.indicator);var o={type:"POST",data:s,dataType:"html",url:n.target,success:function(t,r){o.dataType=="html"&&$(e).html(t),e.editing=!1,f.apply(e,[t,n]),$.trim($(e).html())||$(e).html(n.placeholder)},error:function(t,r,i){p.apply(v,[n,e,t])}};$.extend(o,n.ajaxoptions),$.ajax(o)}return $(e).attr("title",n.tooltip),!1})}),this.reset=function(t){this.editing&&!1!==h.apply(t,[n,e])&&($(e).html(e.revert),e.editing=!1,$.trim($(e).html())||$(e).html(n.placeholder),n.tooltip&&$(e).attr("title",n.tooltip))}})},$.editable={types:{defaults:{element:function(e,t){var n=$('<input type="hidden"></input>');return $(this).append(n),n},content:function(e,t,n){$(":input:first",this).val(e)},reset:function(e,t){t.reset(this)},buttons:function(e,t){var n=this;if(e.submit){if(e.submit.match(/>$/))var r=$(e.submit).click(function(){r.attr("type")!="submit"&&n.submit()});else{var r=$('<button type="submit" />');r.html(e.submit)}$(this).append(r)}if(e.cancel){if(e.cancel.match(/>$/))var i=$(e.cancel);else{var i=$('<button type="cancel" />');i.html(e.cancel)}$(this).append(i),$(i).click(function(r){if($.isFunction($.editable.types[e.type].reset))var i=$.editable.types[e.type].reset;else var i=$.editable.types.defaults.reset;return i.apply(n,[e,t]),!1})}}},text:{element:function(e,t){var n=$("<input />");return e.width!="none"&&n.width(e.width),e.height!="none"&&n.height(e.height),n.attr("autocomplete","off"),$(this).append(n),n}},textarea:{element:function(e,t){var n=$("<textarea />");return e.rows?n.attr("rows",e.rows):e.height!="none"&&n.height(e.height),e.cols?n.attr("cols",e.cols):e.width!="none"&&n.width(e.width),$(this).append(n),n}},select:{element:function(e,t){var n=$("<select />");return $(this).append(n),n},content:function(data,settings,original){if(String==data.constructor)eval("var json = "+data);else var json=data;for(var key in json){if(!json.hasOwnProperty(key))continue;if("selected"==key)continue;var option=$("<option />").val(key).append(json[key]);$("select",this).append(option)}$("select",this).children().each(function(){($(this).val()==json["selected"]||$(this).text()==$.trim(original.revert))&&$(this).attr("selected","selected")})}}},addInputType:function(e,t){$.editable.types[e]=t}},$.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable",onblur:"cancel",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}},!0}),require(["jquery","jquery.jeditable"],function(e){function n(n,r){var i=e(this),s=t+i.attr("data-api-url"),o=i.attr("data-api-name"),u={};return u[o]=n,e.ajax({url:s,type:"PUT",data:u,success:function(){},error:function(){alert("There was an error sending your changes to the server - please refresh the page and try again.")}}),n}var t="/api/v1";e(function(){var t=e("body.signed_in");t.find(".edit-in-place").editable(n,{}),t.find(".edit-in-place-textarea").editable(n,{type:"textarea",submit:"OK",onblur:"ignore"})})}),define("augmenters/edit-in-place",function(){}),function(e,t){typeof exports!="undefined"?t(e,exports,require("underscore")):typeof define=="function"&&define.amd?define("Backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)}):e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender)}(this,function(e,t,n,r){var i=e.Backbone,s=Array.prototype.slice,o=Array.prototype.splice;t.VERSION="0.9.2",t.setDomLibrary=function(e){r=e},t.noConflict=function(){return e.Backbone=i,t},t.emulateHTTP=!1,t.emulateJSON=!1;var u=/\s+/,a=t.Events={on:function(e,t,n){var r,i,s,o,a;if(!t)return this;e=e.split(u),r=this._callbacks||(this._callbacks={});while(i=e.shift())a=r[i],s=a?a.tail:{},s.next=o={},s.context=n,s.callback=t,r[i]={tail:o,next:a?a.next:s};return this},off:function(e,t,r){var i,s,o,a,f,l;if(!(s=this._callbacks))return;if(!(e||t||r))return delete this._callbacks,this;e=e?e.split(u):n.keys(s);while(i=e.shift()){o=s[i],delete s[i];if(!o||!t&&!r)continue;a=o.tail;while((o=o.next)!==a)f=o.callback,l=o.context,(t&&f!==t||r&&l!==r)&&this.on(i,f,l)}return this},trigger:function(e){var t,n,r,i,o,a,f;if(!(r=this._callbacks))return this;a=r.all,e=e.split(u),f=s.call(arguments,1);while(t=e.shift()){if(n=r[t]){i=n.tail;while((n=n.next)!==i)n.callback.apply(n.context||this,f)}if(n=a){i=n.tail,o=[t].concat(f);while((n=n.next)!==i)n.callback.apply(n.context||this,o)}}return this}};a.bind=a.on,a.unbind=a.off;var f=t.Model=function(e,t){var r;e||(e={}),t&&t.parse&&(e=this.parse(e));if(r=C(this,"defaults"))e=n.extend({},r,e);t&&t.collection&&(this.collection=t.collection),this.attributes={},this._escapedAttributes={},this.cid=n.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(e,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=n.clone(this.attributes),this.initialize.apply(this,arguments)};n.extend(f.prototype,a,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var r=this.get(e);return this._escapedAttributes[e]=n.escape(r==null?"":""+r)},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o;n.isObject(e)||e==null?(i=e,r=t):(i={},i[e]=t),r||(r={});if(!i)return this;i instanceof f&&(i=i.attributes);if(r.unset)for(s in i)i[s]=void 0;if(!this._validate(i,r))return!1;this.idAttribute in i&&(this.id=i[this.idAttribute]);var u=r.changes={},a=this.attributes,l=this._escapedAttributes,c=this._previousAttributes||{};for(s in i){o=i[s];if(!n.isEqual(a[s],o)||r.unset&&n.has(a,s))delete l[s],(r.silent?this._silent:u)[s]=!0;r.unset?delete a[s]:a[s]=o,!n.isEqual(c[s],o)||n.has(a,s)!=n.has(c,s)?(this.changed[s]=o,r.silent||(this._pending[s]=!0)):(delete this.changed[s],delete this._pending[s])}return r.silent||this.change(r),this},unset:function(e,t){return(t||(t={})).unset=!0,this.set(e,null,t)},clear:function(e){return(e||(e={})).unset=!0,this.set(n.clone(this.attributes),e)},fetch:function(e){e=e?n.clone(e):{};var r=this,i=e.success;return e.success=function(t,n,s){if(!r.set(r.parse(t,s),e))return!1;i&&i(r,t)},e.error=t.wrapError(e.error,r,e),(this.sync||t.sync).call(this,"read",this,e)},save:function(e,r,i){var s,o;n.isObject(e)||e==null?(s=e,i=r):(s={},s[e]=r),i=i?n.clone(i):{};if(i.wait){if(!this._validate(s,i))return!1;o=n.clone(this.attributes)}var u=n.extend({},i,{silent:!0});if(s&&!this.set(s,i.wait?u:i))return!1;var a=this,f=i.success;i.success=function(e,t,r){var o=a.parse(e,r);i.wait&&(delete i.wait,o=n.extend(s||{},o));if(!a.set(o,i))return!1;f?f(a,e):a.trigger("sync",a,e,i)},i.error=t.wrapError(i.error,a,i);var l=this.isNew()?"create":"update",c=(this.sync||t.sync).call(this,l,this,i);return i.wait&&this.set(o,u),c},destroy:function(e){e=e?n.clone(e):{};var r=this,i=e.success,s=function(){r.trigger("destroy",r,r.collection,e)};if(this.isNew())return s(),!1;e.success=function(t){e.wait&&s(),i?i(r,t):r.trigger("sync",r,t,e)},e.error=t.wrapError(e.error,r,e);var o=(this.sync||t.sync).call(this,"delete",this,e);return e.wait||s(),o},url:function(){var e=C(this,"urlRoot")||C(this.collection,"url")||k();return this.isNew()?e:e+(e.charAt(e.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){e||(e={});var t=this._changing;this._changing=!0;for(var r in this._silent)this._pending[r]=!0;var i=n.extend({},e.changes,this._silent);this._silent={};for(var r in i)this.trigger("change:"+r,this,this.get(r),e);if(t)return this;while(!n.isEmpty(this._pending)){this._pending={},this.trigger("change",this,e);for(var r in this.changed){if(this._pending[r]||this._silent[r])continue;delete this.changed[r]}this._previousAttributes=n.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(e){return arguments.length?n.has(this.changed,e):!n.isEmpty(this.changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._previousAttributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validate(e,t);return r?(t&&t.error?t.error(this,r,t):this.trigger("error",this,r,t),!1):!0}});var l=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})};n.extend(l.prototype,a,{model:f,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},add:function(e,t){var r,i,s,u,a,f,l={},c={},h=[];t||(t={}),e=n.isArray(e)?e.slice():[e];for(r=0,s=e.length;r<s;r++){if(!(u=e[r]=this._prepareModel(e[r],t)))throw new Error("Can't add an invalid model to a collection");a=u.cid,f=u.id;if(l[a]||this._byCid[a]||f!=null&&(c[f]||this._byId[f])){h.push(r);continue}l[a]=c[f]=u}r=h.length;while(r--)e.splice(h[r],1);for(r=0,s=e.length;r<s;r++)(u=e[r]).on("all",this._onModelEvent,this),this._byCid[u.cid]=u,u.id!=null&&(this._byId[u.id]=u);this.length+=s,i=t.at!=null?t.at:this.models.length,o.apply(this.models,[i,0].concat(e)),this.comparator&&this.sort({silent:!0});if(t.silent)return this;for(r=0,s=this.models.length;r<s;r++){if(!l[(u=this.models[r]).cid])continue;t.index=r,u.trigger("add",u,this,t)}return this},remove:function(e,t){var r,i,s,o;t||(t={}),e=n.isArray(e)?e.slice():[e];for(r=0,i=e.length;r<i;r++){o=this.getByCid(e[r])||this.get(e[r]);if(!o)continue;delete this._byId[o.id],delete this._byCid[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,t),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return n.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){e||(e={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var t=n.bind(this.comparator,this);return this.comparator.length==1?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return n.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r]);return this._reset(),this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?n.clone(e):{},e.parse===undefined&&(e.parse=!0);var r=this,i=e.success;return e.success=function(t,n,s){r[e.add?"add":"reset"](r.parse(t,s),e),i&&i(r,t)},e.error=t.wrapError(e.error,r,e),(this.sync||t.sync).call(this,"read",this,e)},create:function(e,t){var r=this;t=t?n.clone(t):{},e=this._prepareModel(e,t);if(!e)return!1;t.wait||r.add(e,t);var i=t.success;return t.success=function(n,s,o){t.wait&&r.add(n,t),i?i(n,s):n.trigger("sync",e,s,t)},e.save(null,t),e},parse:function(e,t){return e},chain:function(){return n(this.models).chain()},_reset:function(e){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){t||(t={});if(e instanceof f)e.collection||(e.collection=this);else{var n=e;t.collection=this,e=new this.model(n,t),e._validate(e.attributes,t)||(e=!1)}return e},_removeReference:function(e){this==e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e=="add"||e=="remove")&&n!=this)return;e=="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments)}});var c=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];n.each(c,function(e){l.prototype[e]=function(){return n[e].apply(n,[this.models].concat(n.toArray(arguments)))}});var h=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},p=/:\w+/g,d=/\*\w+/g,v=/[-[\]{}()+?.,\\^$|#\s]/g;n.extend(h.prototype,a,{initialize:function(){},route:function(e,r,i){return t.history||(t.history=new m),n.isRegExp(e)||(e=this._routeToRegExp(e)),i||(i=this[r]),t.history.route(e,n.bind(function(n){var s=this._extractParameters(e,n);i&&i.apply(this,s),this.trigger.apply(this,["route:"+r].concat(s)),t.history.trigger("route",this,r,s)},this)),this},navigate:function(e,n){t.history.navigate(e,n)},_bindRoutes:function(){if(!this.routes)return;var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var n=0,r=e.length;n<r;n++)this.route(e[n][0],e[n][1],this[e[n][1]])},_routeToRegExp:function(e){return e=e.replace(v,"\\$&").replace(p,"([^/]+)").replace(d,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var m=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl")},g=/^[#\/]/,y=/msie [\w.]+/;m.started=!1,n.extend(m.prototype,a,{interval:50,getHash:function(e){var t=e?e.location:window.location,n=t.href.match(/#(.*)$/);return n?n[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||t){e=window.location.pathname;var n=window.location.search;n&&(e+=n)}else e=this.getHash();return e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e.replace(g,"")},start:function(e){if(m.started)throw new Error("Backbone.history has already been started");m.started=!0,this.options=n.extend({},{root:"/"},this.options,e),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var t=this.getFragment(),i=document.documentMode,s=y.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);s&&(this.iframe=r('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?r(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?r(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var o=window.location,u=o.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&o.hash&&(this.fragment=this.getHash().replace(g,""),window.history.replaceState({},document.title,o.protocol+"//"+o.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){r(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),m.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t==this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),r=n.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return r},navigate:function(e,t){if(!m.started)return!1;if(!t||t===!0)t={trigger:t};var n=(e||"").replace(g,"");if(this.fragment==n)return;this._hasPushState?(n.indexOf(this.options.root)!=0&&(n=this.options.root+n),this.fragment=n,window.history[t.replace?"replaceState":"pushState"]({},document.title,n)):this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,t.replace),this.iframe&&n!=this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,t.replace))):window.location.assign(this.options.root+e),t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){n?e.replace(e.toString().replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}});var b=t.View=function(e){this.cid=n.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName"];n.extend(b.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(e,t,n){var i=document.createElement(e);return t&&r(i).attr(t),n!=null&&r(i).html(n),i},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof r?e:r(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=C(this,"events")))return;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)throw new Error('Method "'+e[t]+'" does not exist');var i=t.match(w),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.bind(s,r):this.$el.delegate(o,s,r)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=n.extend({},this.options,e));for(var t=0,r=E.length;t<r;t++){var i=E[t];e[i]&&(this[i]=e[i])}this.options=e},_ensureElement:function(){if(!this.el){var e=C(this,"attributes")||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.setElement(this.make(this.tagName,e),!1)}else this.setElement(this.el,!1)}});var S=function(e,t){var n=N(this,e,t);return n.extend=this.extend,n};f.extend=l.extend=h.extend=b.extend=S;var x={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};t.sync=function(e,i,s){var o=x[e];s||(s={});var u={type:o,dataType:"json"};return s.url||(u.url=C(i,"url")||k()),!s.data&&i&&(e=="create"||e=="update")&&(u.contentType="application/json",u.data=JSON.stringify(i.toJSON())),t.emulateJSON&&(u.contentType="application/x-www-form-urlencoded",u.data=u.data?{model:u.data}:{}),t.emulateHTTP&&(o==="PUT"||o==="DELETE")&&(t.emulateJSON&&(u.data._method=o),u.type="POST",u.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",o)}),u.type!=="GET"&&!t.emulateJSON&&(u.processData=!1),r.ajax(n.extend(u,s))},t.wrapError=function(e,t,n){return function(r,i){i=r===t?i:r,e?e(t,i,n):t.trigger("error",t,i,n)}};var T=function(){},N=function(e,t,r){var i;return t&&t.hasOwnProperty("constructor")?i=t.constructor:i=function(){e.apply(this,arguments)},n.extend(i,e),T.prototype=e.prototype,i.prototype=new T,t&&n.extend(i.prototype,t),r&&n.extend(i,r),i.prototype.constructor=i,i.__super__=e.prototype,i},C=function(e,t){return!e||!e[t]?null:n.isFunction(e[t])?e[t]():e[t]},k=function(){throw new Error('A "url" property or function must be specified')};return t}),function(e,t){if(typeof exports=="object"){var n=require("jquery"),r=require("underscore"),i=require("Backbone");module.exports=t(n,r,i)}else typeof define=="function"&&define.amd&&define("Backbone.Marionette",["jquery","underscore","Backbone"],t)}(this,function(e,t,n){return n.Marionette=function(e,t,n){var r={};r.version="0.8.4",r.View=e.View.extend({getTemplateSelector:function(){var e;return this.options&&this.options.template?e=this.options.template:e=this.template,t.isFunction(e)&&(e=e.call(this)),e},serializeData:function(){var e;return this.model?e=this.model.toJSON():this.collection&&(e={items:this.collection.toJSON()}),e=this.mixinTemplateHelpers(e),e},mixinTemplateHelpers:function(e){e=e||{};var n=this.templateHelpers;return t.isFunction(n)&&(n=n.call(this)),t.extend(e,n)},configureTriggers:function(){if(!this.triggers)return;var e=this.triggers,n=this,r={};return t.isFunction(e)&&(e=e.call(this)),t.each(e,function(e,t){r[t]=function(t){t&&t.preventDefault&&t.preventDefault(),t&&t.stopPropagation&&t.stopPropagation(),n.trigger(e)}}),r},delegateEvents:function(n){n=n||this.events,t.isFunction(n)&&(n=n.call(this));var r={},i=this.configureTriggers();t.extend(r,n,i),e.View.prototype.delegateEvents.call(this,r)},close:function(){this.beforeClose&&this.beforeClose(),this.unbindAll(),this.remove(),this.onClose&&this.onClose(),this.trigger("close"),this.unbind()}}),r.ItemView=r.View.extend({constructor:function(){var e=i.call(arguments);r.View.prototype.constructor.apply(this,e),t.bindAll(this,"render"),this.initialEvents()},initialEvents:function(){this.collection&&this.bindTo(this.collection,"reset",this.render,this)},render:function(){var e=this,t=n.Deferred(),r=function(){e.trigger("before:render",e),e.trigger("item:before:render",e);var t=e.serializeData();n.when(t).then(i)},i=function(t){var r=e.renderHtml(t);n.when(r).then(s)},s=function(t){e.$el.html(t),o(e.onRender,u,e)},u=function(){e.trigger("render",e),e.trigger("item:rendered",e),t.resolve()};return o(this.beforeRender,r,this),t.promise()},renderHtml:function(e){var t=this.getTemplateSelector();return r.Renderer.render(t,e)},close:function(){this.trigger("item:before:close"),r.View.prototype.close.apply(this,arguments),this.trigger("item:closed")}}),r.CollectionView=r.View.extend({constructor:function(){r.View.prototype.constructor.apply(this,arguments),t.bindAll(this,"addItemView","render"),this.initialEvents()},initialEvents:function(){this.collection&&(this.bindTo(this.collection,"add",this.addChildView,this),this.bindTo(this.collection,"remove",this.removeItemView,this),this.bindTo(this.collection,"reset",this.render,this))},addChildView:function(e){var t=this.getItemView();return this.addItemView(e,t)},render:function(){var e=this,t=n.Deferred(),r=[],i=this.getItemView();return this.beforeRender&&this.beforeRender(),this.trigger("collection:before:render",this),this.closeChildren(),this.collection&&this.collection.each(function(t){var n=e.addItemView(t,i);r.push(n)}),t.done(function(){this.onRender&&this.onRender(),this.trigger("collection:rendered",this)}),n.when.apply(this,r).then(function(){t.resolveWith(e)}),t.promise()},getItemView:function(){var e=this.options.itemView||this.itemView;if(!e){var t=new Error("An `itemView` must be specified");throw t.name="NoItemViewError",t}return e},addItemView:function(e,t){var r=this,s=this.buildItemView(e,t);this.bindTo(s,"all",function(){var e=i.call(arguments);e[0]="itemview:"+e[0],e.splice(1,0,s),r.trigger.apply(r,e)}),this.storeChild(s),this.trigger("item:added",s);var o=s.render();return n.when(o).then(function(){r.appendHtml(r,s)}),o},buildItemView:function(e,t){var n=new t({model:e});return n},removeItemView:function(e){var t=this.children[e.cid];t&&(t.close(),delete this.children[e.cid]),this.trigger("item:removed",t)},appendHtml:function(e,t){e.$el.append(t.el)},storeChild:function(e){this.children||(this.children={}),this.children[e.model.cid]=e},close:function(){this.trigger("collection:before:close"),this.closeChildren(),r.View.prototype.close.apply(this,arguments),this.trigger("collection:closed")},closeChildren:function(){this.children&&t.each(this.children,function(e){e.close()})}}),r.CompositeView=r.CollectionView.extend({constructor:function(e){r.CollectionView.apply(this,arguments),this.itemView=this.getItemView()},getItemView:function(){return this.itemView||this.constructor},render:function(){var e=this,t=n.Deferred(),r=this.renderModel();return n.when(r).then(function(r){e.$el.html(r),e.trigger("composite:model:rendered"),e.trigger("render");var i=e.renderCollection();n.when(i).then(function(){t.resolve()})}),t.done(function(){e.trigger("composite:rendered")}),t.promise()},renderCollection:function(){var e=r.CollectionView.prototype.render.apply(this,arguments);return e.done(function(){this.trigger("composite:collection:rendered")}),e.promise()},renderModel:function(){var e={};e=this.serializeData();var t=this.getTemplateSelector();return r.Renderer.render(t,e)}}),r.Region=function(e){this.options=e||{},t.extend(this,e);if(!this.el){var n=new Error("An 'el' must be specified");throw n.name="NoElError",n}this.initialize&&this.initialize.apply(this,arguments)},t.extend(r.Region.prototype,e.Events,{show:function(e,t){this.ensureEl(),this.close(),this.open(e,t),this.currentView=e},ensureEl:function(){if(!this.$el||this.$el.length===0)this.$el=this.getEl(this.el)},getEl:function(e){return n(e)},open:function(e,t){var r=this;t=t||"html",n.when(e.render()).then(function(){r.$el[t](e.el),e.onShow&&e.onShow(),r.onShow&&r.onShow(e),e.trigger("show"),r.trigger("view:show",e)})},close:function(){var e=this.currentView;if(!e)return;e.close&&e.close(),this.trigger("view:closed",e),delete this.currentView},attachView:function(e){this.currentView=e}}),r.Layout=r.ItemView.extend({constructor:function(){this.vent=new e.Marionette.EventAggregator,e.Marionette.ItemView.apply(this,arguments),this.regionManagers={}},render:function(){return this.initializeRegions(),e.Marionette.ItemView.prototype.render.call(this,arguments)},close:function(){this.closeRegions(),e.Marionette.ItemView.prototype.close.call(this,arguments)},initializeRegions:function(){var n=this;t.each(this.regions,function(t,r){var i=new e.Marionette.Region({el:t,getEl:function(e){return n.$(e)}});n.regionManagers[r]=i,n[r]=i})},closeRegions:function(){var e=this;t.each(this.regionManagers,function(t,n){t.close(),delete e[n]}),this.regionManagers={}}}),r.AppRouter=e.Router.extend({constructor:function(t){e.Router.prototype.constructor.call(this,t);if(this.appRoutes){var n=this.controller;t&&t.controller&&(n=t.controller),this.processAppRoutes(n,this.appRoutes)}},processAppRoutes:function(e,n){var r,i,s,o,u,a=[],f=this;for(s in n)n.hasOwnProperty(s)&&a.unshift([s,n[s]]);o=a.length;for(u=0;u<o;u++){s=a[u][0],i=a[u][1],r=e[i];if(!r){var l="Method '"+i+"' was not found on the controller",c=new Error(l);throw c.name="NoMethodError",c}r=t.bind(r,e),f.route(s,i,r)}}}),r.Application=function(e){this.initCallbacks=new r.Callbacks,this.vent=new r.EventAggregator,t.extend(this,e)},t.extend(r.Application.prototype,e.Events,{addInitializer:function(e){this.initCallbacks.add(e)},start:function(e){this.trigger("initialize:before",e),this.initCallbacks.run(this,e),this.trigger("initialize:after",e),this.trigger("start",e)},addRegions:function(e){var t,n,i;for(i in e)e.hasOwnProperty(i)&&(t=e[i],typeof t=="string"?n=new r.Region({el:t}):n=new t,this[i]=n)}}),r.BindTo={bindTo:function(e,t,n,r){r=r||this,e.on(t,n,r),this.bindings||(this.bindings=[]);var i={obj:e,eventName:t,callback:n,context:r};return this.bindings.push(i),i},unbindFrom:function(e){e.obj.off(e.eventName,e.callback),this.bindings=t.reject(this.bindings,function(t){return t===e})},unbindAll:function(){var e=this,n=t.map(this.bindings,t.identity);t.each(n,function(t,n){e.unbindFrom(t)})}},r.Callbacks=function(){this.deferred=n.Deferred(),this.promise=this.deferred.promise()},t.extend(r.Callbacks.prototype,{add:function(e){this.promise.done(function(t,n){e.call(t,n)})},run:function(e,t){this.deferred.resolve(e,t)}}),r.EventAggregator=function(e){t.extend(this,e)},t.extend(r.EventAggregator.prototype,e.Events,r.BindTo,{bindTo:function(e,t,n){return r.BindTo.bindTo.call(this,this,e,t,n)}}),r.TemplateCache={templates:{},loaders:{},get:function(e){var t=this,r=n.Deferred(),i=this.templates[e];if(i)r.resolve(i);else{var s=this.loaders[e];s?r=s:(this.loaders[e]=r,this.loadTemplate(e,function(n){delete t.loaders[e],t.templates[e]=n,r.resolve(n)}))}return r.promise()},loadTemplate:function(e,t){var r=n(e).html();if(!r||r.length===0){var i="Could not find template: '"+e+"'",s=new Error(i);throw s.name="NoTemplateError",s}r=this.compileTemplate(r),t.call(this,r)},compileTemplate:function(e){return t.template(e)},clear:function(){var e,t=arguments.length;if(t>0)for(e=0;e<t;e++)delete this.templates[arguments[e]];else this.templates={}}},r.Renderer={render:function(e,t){var i=this,s=n.Deferred(),o=r.TemplateCache.get(e);return n.when(o).then(function(e){var n=i.renderTemplate(e,t);s.resolve(n)}),s.promise()},renderTemplate:function(e,t){var n=e(t);return n}},r.Modules={module:function(n,i){var s,o,u,a=this,f=this,n=n.split("."),l=n.length;for(var c=0;c<l;c++){var h=c===l-1;s=n[c],o=a[s],o||(o=new r.Application),h&&i&&(u=i(o,f,e,r,jQuery,t),u&&(o=u)),a[s]!==o&&(a[s]=o),a=o}return o}};var i=Array.prototype.slice,s=r.View.extend;r.Region.extend=s,r.Application.extend=s,r.Application.prototype.module=r.Modules.module,t.extend(r.View.prototype,r.BindTo),t.extend(r.Application.prototype,r.BindTo),t.extend(r.Region.prototype,r.BindTo);var o=function(e,t,r){var i;e&&(i=e.call(r)),n.when(i).then(t)};return r}(n,t,window.jQuery||window.Zepto||window.ender),n.Marionette}),define("instance-admin/app",["Backbone","Backbone.Marionette"],function(e,t){var n=new e.Marionette.Application;return n}),define("instance-admin/models/person",["Backbone"],function(e){var t=e.Model.extend({urlRoot:"/api/v1/person",schema:{name:{dataType:"Text",validators:["required"]},slug:{dataType:"Text",validators:["required"]}}});return t}),define("backbone-forms",["jquery","Backbone"],function(){var e=function(){return Backbone.View.extend({fields:null,initialize:function(e){this.schema=function(){if(e.schema)return e.schema;var t=e.model;if(!t)throw new Error("Could not find schema");return _.isFunction(t.schema)?t.schema():t.schema}(),this.model=e.model,this.data=e.data,this.fieldsToRender=e.fields||_.keys(this.schema),this.fieldsets=e.fieldsets,this.templateName=e.template||"form",this.fields={}},render:function(){var t=this,n=this.fieldsets,r=e.templates,i=$(r[this.templateName]({fieldsets:'<div class="bbf-placeholder"></div>'})),s=$(".bbf-placeholder",i);return n||(n=[{fields:this.fieldsToRender}]),_.each(n,function(e){_(e).isArray()&&(e={fields:e});var n=$(r.fieldset(_.extend({},e,{legend:e.legend?"<legend>"+e.legend+"</legend>":"",fields:'<div class="bbf-placeholder"></div>'}))),i=$(".bbf-placeholder",n);t.renderFields(e.fields,i),i=i.children().unwrap(),s.append(n)}),s.children().unwrap(),this.setElement(i),this},renderFields:function(t,n){var r=this,i=this.schema,s=this.model,o=this.data,u=this.fields,a=e.helpers.getNested;_.each(t,function(t){var f=function(){if(i[t])return i[t];var e=t.replace(/\./g,".subSchema.");return a(i,e)}();if(!f)throw"Field '"+t+"' not found in schema";var l={form:r,key:t,schema:f,idPrefix:r.options.idPrefix};s?l.model=s:o?l.value=o[t]:l.value=null;var c=new e.Field(l);f.type=="Hidden"?c.editor=helpers.createEditor("Hidden",l):n.append(c.render().el),u[t]=c})},validate:function(){var e=this,t=this.fields,n=this.model,r={};_.each(t,function(e){var t=e.validate();t&&(r[e.key]=t)});if(n&&n.validate){var i=n.validate(this.getValue());if(i){var s=_.isObject(i)&&!_.isArray(i);s||(r._others=r._others||[],r._others.push(i)),s&&_.each(i,function(t,n){if(e.fields[n]&&!r[n])e.fields[n].setError(t);else{r._others=r._others||[];var i={};i[n]=t,r._others.push(i)}})}}return _.isEmpty(r)?null:r},commit:function(){var e=this.validate();if(e)return e;var t;this.model.set(this.getValue(),{error:function(e,n){t=n}});if(t)return t},getValue:function(e){if(e)return this.fields[e].getValue();var t={};return _.each(this.fields,function(e){t[e.key]=e.getValue()}),t},setValue:function(e){for(var t in e)this.fields[t].setValue(e[t])},remove:function(){var e=this.fields;for(var t in e)e[t].remove();Backbone.View.prototype.remove.call(this)}})}(),t={form:'      <form class="bbf-form">{{fieldsets}}</form>    ',fieldset:"      <fieldset>        {{legend}}        <ul>{{fields}}</ul>      </fieldset>    ",field:'    <li class="bbf-field bbf-field{{type}}">      <label for="{{id}}">{{title}}</label>      <div class="bbf-editor bbf-editor{{type}}">{{editor}}</div>      <div class="bbf-help">{{help}}</div>    </li>    '},n={error:"bbf-error"};return e.helpers=function(){var t={};return t.getNested=function(e,t){var n=t.split("."),r=e;for(var i=0,s=n.length;i<s;i++)r=r[n[i]];return r},t.keyToTitle=function(e){return e=e.replace(/([A-Z])/g," $1"),e=e.replace(/^./,function(e){return e.toUpperCase()}),e},t.compileTemplate=function(e){var t=_.templateSettings.interpolate;_.templateSettings.interpolate=/\{\{(.+?)\}\}/g;var n=_.template(e);return _.templateSettings.interpolate=t,n},t.createTemplate=function(e,n){var r=t.compileTemplate(e);return n?r(n):r},t.setTemplateCompiler=function(e){t.compileTemplate=e},t.setTemplates=function(n,r){var i=t.createTemplate;e.templates=e.templates||{},e.classNames=e.classNames||{},_.each(n,function(t,n,r){_.isString(t)&&(t=i(t)),e.templates[n]=t}),_.extend(e.classNames,r)},t.createEditor=function(t,n){var r;return _.isString(t)?r=e.editors[t]:r=t,new r(n)},t.triggerCancellableEvent=function(e,t,n,r){if(!e._callbacks||!e._callbacks[t])return r();var i=e._callbacks[t].next;if(!i)return r();var s=i.callback,o=i.context||this;n.push(r),s.apply(o,n)},t.getValidator=function(t){var n=e.validators;if(_.isRegExp(t))return n.regexp({regexp:t});if(_.isString(t)){if(!n[t])throw new Error('Validator "'+t+'" not found');return n[t]()}if(_.isFunction(t))return t;if(_.isObject(t)&&t.type){var r=t;return n[r.type](r)}throw new Error("Invalid validator: "+t)},t}(),e.validators=function(){var t={};return t.errMessages={required:"Required",regexp:"Invalid",email:"Invalid email address",url:"Invalid URL",match:'Must match field "{{field}}"'},t.required=function(t){return t=_.extend({type:"required",message:this.errMessages.required},t),function(r){t.value=r;var i={type:t.type,message:e.helpers.createTemplate(t.message,t)};if(r===null||r===undefined||r==="")return i}},t.regexp=function(t){if(!t.regexp)throw new Error('Missing required "regexp" option for "regexp" validator');return t=_.extend({type:"regexp",message:this.errMessages.regexp},t),function(r){t.value=r;var i={type:t.type,message:e.helpers.createTemplate(t.message,t)};if(r===null||r===undefined||r==="")return;if(!t.regexp.test(r))return i}},t.email=function(e){return e=_.extend({type:"email",message:this.errMessages.email,regexp:/^[\w\-]{1,}([\w\-.]{1,1}[\w\-]{1,}){0,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/},e),t.regexp(e)},t.url=function(e){return e=_.extend({type:"url",message:this.errMessages.url,regexp:/^(http|https):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i},e),t.regexp(e)},t.match=function(t){if(!t.field)throw new Error('Missing required "field" options for "match" validator');return t=_.extend({type:"match",message:this.errMessages.match},t),function(r,i){t.value=r;var s={type:t.type,message:e.helpers.createTemplate(t.message,t)};if(r===null||r===undefined||r==="")return;if(r!=i[t.field])return s}},t}(),e.Field=function(){var t=e.helpers,n=e.templates;return Backbone.View.extend({initialize:function(e){this.form=e.form,this.key=e.key,this.value=e.value,this.model=e.model;var n=this.schema=function(){return _.isString(e.schema)?{type:e.schema}:e.schema||{}}();n.type||(n.type="Text"),n.title||(n.title=t.keyToTitle(this.key)),n.template||(n.template="field")},render:function(){var n=this.schema,r=e.templates,i={form:this.form,key:this.key,schema:n,idPrefix:this.options.idPrefix,id:this.getId()};this.model?i.model=this.model:i.value=this.value;var s=this.editor=t.createEditor(n.type,i),o=$(r[n.template]({key:this.key,title:n.title,id:s.id,type:n.type,editor:'<span class="bbf-placeholder-editor"></span>',help:'<span class="bbf-placeholder-help"></span>'})),u=$(".bbf-placeholder-editor",o);return u.append(s.render().el),u.children().unwrap(),this.$help=$(".bbf-placeholder-help",o).parent(),this.$help.empty(),this.schema.help&&this.$help.html(this.schema.help),this.schema.fieldClass&&o.addClass(this.schema.fieldClass),this.schema.fieldAttrs&&o.attr(this.schema.fieldAttrs),this.setElement(o),this},getId:function(){var e=this.options.idPrefix,t=this.key;return t=t.replace(/\./g,"_"),_.isString(e)||_.isNumber(e)?e+t:_.isNull(e)?t:this.model?this.model.cid+"_"+t:t},validate:function(){var e=this.editor.validate();return e?this.setError(e.message):this.clearError(),e},setError:function(t){if(this.editor.hasNestedForm)return;var n=e.classNames.error;this.$el.addClass(n),this.$help&&this.$help.html(t)},clearError:function(){var t=e.classNames.error;this.$el.removeClass(t);if(this.$help){this.$help.empty();var n=this.schema.help;n&&this.$help.html(n)}},commit:function(){return this.editor.commit()},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},logValue:function(){if(!console||!console.log)return;console.log(this.getValue())},remove:function(){this.editor.remove(),Backbone.View.prototype.remove.call(this)}})}(),e.editors=function(){var t={};return t.Base=Backbone.View.extend({defaultValue:null,initialize:function(e){var e=e||{};if(e.model){if(!e.key)throw"Missing option: 'key'";this.model=e.model,this.key=e.key,this.value=this.model.get(this.key)}else e.value&&(this.value=e.value);this.value===undefined&&(this.value=this.defaultValue),this.form=e.form,this.schema=e.schema||{},this.validators=e.validators||this.schema.validators,this.$el.attr("name",this.getName()),this.schema.editorClass&&this.$el.addClass(this.schema.editorClass),this.schema.editorAttrs&&this.$el.attr(this.schema.editorAttrs)},getValue:function(){throw"Not implemented. Extend and override this method."},setValue:function(){throw"Not implemented. Extend and override this method."},getName:function(){var e=this.key||"";return e.replace(/\./g,"_")},commit:function(){var e=this.validate();if(e)return e;this.model.set(this.key,this.getValue(),{error:function(t,n){e=n}});if(e)return e},validate:function(){var t=this.$el,n=null,r=this.getValue(),i=this.form?this.form.getValue():{},s=this.validators,o=e.helpers.getValidator;return s&&_.each(s,function(e){n||(n=o(e)(r,i))}),n}}),t.Text=t.Base.extend({tagName:"input",defaultValue:"",initialize:function(e){t.Base.prototype.initialize.call(this,e);var n=this.schema,r="text";n&&n.editorAttrs&&n.editorAttrs.type&&(r=n.editorAttrs.type),n&&n.dataType&&(r=n.dataType),this.$el.attr("type",r)},render:function(){return this.setValue(this.value),this},getValue:function(){return this.$el.val()},setValue:function(e){this.$el.val(e)}}),t.Number=t.Text.extend({defaultValue:0,events:{keypress:"onKeyPress"},initialize:function(e){t.Text.prototype.initialize.call(this,e),this.$el.attr("type","number")},onKeyPress:function(e){if(e.charCode==0)return;var t=this.$el.val()+String.fromCharCode(e.charCode),n=/^[0-9]*\.?[0-9]*?$/.test(t);n||e.preventDefault()},getValue:function(){var e=this.$el.val();return e===""?null:parseFloat(e,10)},setValue:function(e){e=e===null?null:parseFloat(e,10),t.Text.prototype.setValue.call(this,e)}}),t.Password=t.Text.extend({initialize:function(e){t.Text.prototype.initialize.call(this,e),this.$el.attr("type","password")}}),t.TextArea=t.Text.extend({tagName:"textarea"}),t.Checkbox=t.Base.extend({defaultValue:!1,tagName:"input",initialize:function(e){t.Base.prototype.initialize.call(this,e),this.$el.attr("type","checkbox")},render:function(){return this.setValue(this.value),this},getValue:function(){return this.$el.attr("checked")?!0:!1},setValue:function(e){e&&this.$el.attr("checked",!0)}}),t.Hidden=t.Base.extend({defaultValue:"",initialize:function(e){t.Text.prototype.initialize.call(this,e),this.$el.attr("type","hidden")},getValue:function(){return this.value},setValue:function(e){this.value=e}}),t.Select=t.Base.extend({tagName:"select",initialize:function(e){t.Base.prototype.initialize.call(this,e);if(!this.schema||!this.schema.options)throw"Missing required 'schema.options'"},render:function(){var e=this.schema.options,t=this;if(e instanceof Backbone.Collection){var n=e;n.length>0?t.renderOptions(e):n.fetch({success:function(n){t.renderOptions(e)}})}else _.isFunction(e)?e(function(e){t.renderOptions(e)}):t.renderOptions(e);return this},renderOptions:function(e){var t=this.$el,n;_.isString(e)?n=e:_.isArray(e)?n=this._arrayToHtml(e):e instanceof Backbone.Collection&&(n=this._collectionToHtml(e)),t.html(n),this.setValue(this.value)},getValue:function(){return this.$el.val()},setValue:function(e){this.$el.val(e)},_collectionToHtml:function(e){var t=[];e.each(function(e){t.push({val:e.id,label:e.toString()})});var n=this._arrayToHtml(t);return n},_arrayToHtml:function(e){var t=[];return _.each(e,function(e){if(_.isObject(e)){var n=e.val?e.val:"";t.push('<option value="'+n+'">'+e.label+"</option>")}else t.push("<option>"+e+"</option>")}),t.join("")}}),t.Radio=t.Select.extend({tagName:"ul",className:"bbf-radio",getValue:function(){return this.$el.find("input[type=radio]:checked").val()},setValue:function(e){this.$el.find("input[type=radio][value="+e+"]").attr("checked",!0)},_arrayToHtml:function(e){var t=[],n=this;return _.each(e,function(e,r){var i="<li>";if(_.isObject(e)){var s=e.val?e.val:"";i+='<input type="radio" name="'+n.id+'" value="'+s+'" id="'+n.id+"-"+r+'" />',i+='<label for="'+n.id+"-"+r+'">'+e.label+"</label>"}else i+='<input type="radio" name="'+n.id+'" value="'+e+'" id="'+n.id+"-"+r+'" />',i+='<label for="'+n.id+"-"+r+'">'+e+"</label>";i+="</li>",t.push(i)}),t.join("")}}),t.Checkboxes=t.Select.extend({tagName:"ul",className:"bbf-checkboxes",getValue:function(){var e=[];return this.$el.find("input[type=checkbox]:checked").each(function(){e.push($(this).val())}),e},setValue:function(e){var t=this;_.each(e,function(e){t.$el.find('input[type=checkbox][value="'+e+'"]').attr("checked",!0)})},_arrayToHtml:function(e){var t=[],n=this;return _.each(e,function(e,r){var i="<li>";if(_.isObject(e)){var s=e.val?e.val:"";i+='<input type="checkbox" name="'+n.id+'" value="'+s+'" id="'+n.id+"-"+r+'" />',i+='<label for="'+n.id+"-"+r+'">'+e.label+"</label>"}else i+='<input type="checkbox" name="'+n.id+'" value="'+e+'" id="'+n.id+"-"+r+'" />',i+='<label for="'+n.id+"-"+r+'">'+e+"</label>";i+="</li>",t.push(i)}),t.join("")}}),t.Object=t.Base.extend({hasNestedForm:!0,className:"bbf-object",defaultValue:{},initialize:function(e){t.Base.prototype.initialize.call(this,e);if(!this.schema.subSchema)throw"Missing required 'schema.subSchema' option for Object editor"},render:function(){var t=this.$el,n=this.value||{},r=this.key,i=this.schema,s=i.subSchema;return this.form=new e({schema:s,data:n,idPrefix:this.id+"_"}),t.html(this.form.render().el),this},getValue:function(){return this.form.getValue()},setValue:function(e){this.value=e,this.render()},remove:function(){this.form.remove(),Backbone.View.prototype.remove.call(this)},validate:function(){return this.form.validate()}}),t.NestedModel=t.Object.extend({initialize:function(e){t.Base.prototype.initialize.call(this,e);if(!e.schema.model)throw'Missing required "schema.model" option for NestedModel editor'},render:function(){var t=this.value||{},n=this.key,r=this.schema.model,i=r.prototype.schema;return _.isFunction(i)&&(i=i()),this.form=new e({schema:i,model:new r(t),idPrefix:this.id+"_"}),this.$el.html(this.form.render().el),this},commit:function(){var e=this.form.commit();return e?(this.$el.addClass("error"),e):t.Object.prototype.commit.call(this)}}),t}(),e.setTemplates=e.helpers.setTemplates,e.setTemplateCompiler=e.helpers.setTemplateCompiler,e.setTemplates(t,n),e}),define("jadeRuntime",[],function(){var e=function(e){function t(e){return e!=null}return Array.isArray||(Array.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),e.merge=function(n,r){var i=n["class"],s=r["class"];if(i||s)i=i||[],s=s||[],Array.isArray(i)||(i=[i]),Array.isArray(s)||(s=[s]),i=i.filter(t),s=s.filter(t),n["class"]=i.concat(s).join(" ");for(var o in r)o!="class"&&(n[o]=r[o]);return n},e.attrs=function(n,r){var i=[],s=n.terse;delete n.terse;var o=Object.keys(n),u=o.length;if(u){i.push("");for(var a=0;a<u;++a){var f=o[a],l=n[f];"boolean"==typeof l||null==l?l&&(s?i.push(f):i.push(f+'="'+f+'"')):0==f.indexOf("data")&&"string"!=typeof l?i.push(f+"='"+JSON.stringify(l)+"'"):"class"==f&&Array.isArray(l)?i.push(f+'="'+e.escape(l.join(" "))+'"'):r&&r[f]?i.push(f+'="'+e.escape(l)+'"'):i.push(f+'="'+l+'"')}}return i.join(" ")},e.escape=function(t){return String(t).replace(/&(?!(\w+|\#\d+);)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},e.rethrow=function(t,n,r){if(!n)throw t;var i=3,s=require("fs").readFileSync(n,"utf8"),o=s.split("\n"),u=Math.max(r-i,0),a=Math.min(o.length,r+i),i=o.slice(u,a).map(function(e,t){var n=t+u+1;return(n==r?"  > ":"    ")+n+"| "+e}).join("\n");throw t.path=n,t.message=(n||"Jade")+":"+r+"\n"+i+"\n\n"+t.message,t},e}({});return e}),define("templates/person/new",["jadeRuntime"],function(jade){return function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp,__indent=[];buf.push('\n<div id="new-person">\n  <form name="create-new-person">\n    <!-- more content inserted in the bb view-->\n    <h2>Suggestions</h2>\n    <ul class="suggestions"></ul>\n    <input type="submit" value="Create new person"/>\n  </form>\n</div>')}return buf.join("")}}),define("instance-admin/views/submit-form-helper",[],function(){return function(e){return e=e||{},function(t){t.preventDefault();var n=e.view||this,r=n.form,i=e.success_cb||function(e,t){document.location=t.meta.edit_url},s=function(e,t){var n=t.responseText;if(!n)return;var i=$.parseJSON(t.responseText).errors||{};_.each(i,function(e,t){r.fields[t]&&r.fields[t].setError(e)})},o=r.commit();_.isEmpty(o)&&n.model.save({},{success:i,error:s})}}}),define("instance-admin/collections/suggestions",["Backbone"],function(e){var t=e.Collection.extend({url:"/api/v1/person"});return t}),define("templates/person/compact_list",["jadeRuntime"],function(jade){return function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp,__indent=[];persons.length?function(){if("number"==typeof persons.length)for(var e=0,t=persons.length;e<t;e++){var n=persons[e];buf.push("\n<li><a"),buf.push(attrs({href:n.meta.edit_url},{href:!0})),buf.push(">"+escape((interp=n.name)==null?"":interp)+" ("+escape((interp=n.slug)==null?"":interp)+") </a></li>")}else for(var e in persons){var n=persons[e];buf.push("\n<li><a"),buf.push(attrs({href:n.meta.edit_url},{href:!0})),buf.push(">"+escape((interp=n.name)==null?"":interp)+" ("+escape((interp=n.slug)==null?"":interp)+") </a></li>")}}.call(this):buf.push("\n<li>No matches</li>")}return buf.join("")}}),define("instance-admin/views/suggestions",["Backbone","underscore","instance-admin/collections/suggestions","templates/person/compact_list"],function(e,t,n,r){var i=e.View.extend({tagName:"ul",className:"suggestions",collection:new n,render:function(){var e=r({persons:this.collection.toJSON()});return this.$el.html(e),this},setName:t.debounce(function(e){var t=this;return e?t.collection.fetch({data:{name:e},success:function(){t.render()}}):(t.collection.reset(),t.render()),t},200)});return i}),define("instance-admin/views/person-new",["jquery","Backbone","backbone-forms","underscore","utils/slugify","templates/person/new","instance-admin/models/person","instance-admin/views/submit-form-helper","instance-admin/views/suggestions"],function(e,t,n,r,i,s,o,u,a){var f=t.View.extend({initialize:function(){this.form=new n({model:this.model,fields:["name","slug"]}),this.suggestionsView=new a},render:function(){var t=e(s({})),n=e(this.form.render().el);return t.find("form").prepend(n.children()),this.$el.html(t),this.$("ul.suggestions").html(this.suggestionsView.render().el),this},events:{"submit form ":"submitForm","keyup input[name=name]":"nameEdit"},submitForm:u(),nameEdit:function(e){var t=this.$(":input[name=name]"),n=this.$(":input[name=slug]");n.val(i(t.val()));var r=this;return r.suggestionsView.setName(t.val()),!0}});return f}),define("templates/person/remove",["jadeRuntime"],function(jade){return function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp,__indent=[];buf.push('\n<div id="remove-person">\n  <form name="remove-person" method="post">\n    <input'),buf.push(attrs({type:"submit",value:"Really delete '"+person.name+"'?"},{type:!0,value:!0})),buf.push("/>\n  </form>\n</div>")}return buf.join("")}}),define("instance-admin/views/person-remove",["jquery","Backbone","backbone-forms","underscore","templates/person/remove","instance-admin/models/person","instance-admin/views/suggestions"],function(e,t,n,r,i,s,o,u){var a=t.View.extend({render:function(){return console.log(this.model.toJSON()),this.$el.html(i({person:this.model.toJSON()})),this},events:{"submit form":"submitForm"},submitForm:function(e){e.preventDefault(),this.model.destroy({success:function(e,t){document.location="/person"},error:function(e,t){alert("Something went wrong with the delete - please try again")}})}});return a}),define("jquery.fancybox",["jquery"],function(e){(function(e,t,n,r){var i=n(e),s=n(t),o=n.fancybox=function(){o.open.apply(this,arguments)},u=!1,a=null,f=t.createTouch!==r,l=function(e){return n.type(e)==="string"},c=function(e){return l(e)&&e.indexOf("%")>0},h=function(e,t){return t&&c(e)&&(e=o.getViewport()[t]/100*parseInt(e,10)),Math.round(e)+"px"};n.extend(o,{version:"2.0.5",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,autoSize:!0,autoResize:!f,autoCenter:!f,fitToView:!0,aspectRatio:!1,topRatio:.5,fixed:!1,scrolling:"auto",wrapCSS:"",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},keys:{next:[13,32,34,39,40],prev:[8,33,37,38],close:[27]},index:0,type:null,href:null,content:null,title:null,tpl:{wrap:'<div class="fancybox-wrap"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe class="fancybox-iframe" name="fancybox-frame{rnd}" frameborder="0" hspace="0"'+(n.browser.msie?' allowtransparency="true"':"")+"></iframe>",swf:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="wmode" value="transparent" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{href}" /><embed src="{href}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="100%" height="100%" wmode="transparent"></embed></object>',error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<div title="Close" class="fancybox-item fancybox-close"></div>',next:'<a title="Next" class="fancybox-nav fancybox-next"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev"><span></span></a>'},openEffect:"fade",openSpeed:300,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:300,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:300,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:300,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:{speedIn:0,speedOut:300,opacity:.8,css:{cursor:"pointer"},closeClick:!0},title:{type:"float"}},onCancel:n.noop,beforeLoad:n.noop,afterLoad:n.noop,beforeShow:n.noop,afterShow:n.noop,beforeClose:n.noop,afterClose:n.noop},group:{},opts:{},coming:null,current:null,isOpen:!1,isOpened:!1,wrap:null,skin:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(e,t){o.close(!0),e&&!n.isArray(e)&&(e=e instanceof n?n(e).get():[e]),o.isActive=!0,o.opts=n.extend(!0,{},o.defaults,t),n.isPlainObject(t)&&t.keys!==r&&(o.opts.keys=t.keys?n.extend({},o.defaults.keys,t.keys):!1),o.group=e,o._start(o.opts.index||0)},cancel:function(){if(o.coming&&!1===o.trigger("onCancel"))return;o.coming=null,o.hideLoading(),o.ajaxLoad&&o.ajaxLoad.abort(),o.ajaxLoad=null,o.imgPreload&&(o.imgPreload.onload=o.imgPreload.onabort=o.imgPreload.onerror=null)},close:function(e){o.cancel();if(!o.current||!1===o.trigger("beforeClose"))return;o.unbindEvents(),!o.isOpen||e&&e[0]===!0?(n(".fancybox-wrap").stop().trigger("onReset").remove(),o._afterZoomOut()):(o.isOpen=o.isOpened=!1,n(".fancybox-item, .fancybox-nav").remove(),o.wrap.stop(!0).removeClass("fancybox-opened"),o.inner.css("overflow","hidden"),o.transitions[o.current.closeMethod]())},play:function(e){var t=function(){clearTimeout(o.player.timer)},r=function(){t(),o.current&&o.player.isActive&&(o.player.timer=setTimeout(o.next,o.current.playSpeed))},i=function(){t(),n("body").unbind(".player"),o.player.isActive=!1,o.trigger("onPlayEnd")},s=function(){o.current&&(o.current.loop||o.current.index<o.group.length-1)&&(o.player.isActive=!0,n("body").bind({"afterShow.player onUpdate.player":r,"onCancel.player beforeClose.player":i,"beforeLoad.player":t}),r(),o.trigger("onPlayStart"))};o.player.isActive||e&&e[0]===!1?i():s()},next:function(){o.current&&o.jumpto(o.current.index+1)},prev:function(){o.current&&o.jumpto(o.current.index-1)},jumpto:function(e){if(!o.current)return;e=parseInt(e,10),o.group.length>1&&o.current.loop&&(e>=o.group.length?e=0:e<0&&(e=o.group.length-1)),o.group[e]!==r&&(o.cancel(),o._start(e))},reposition:function(e,t){var n;o.isOpen&&(n=o._getPosition(t),e&&e.type==="scroll"?(delete n.position,o.wrap.stop(!0,!0).animate(n,200)):o.wrap.css(n))},update:function(e){if(!o.isOpen)return;u||(a=setTimeout(function(){var t=o.current,n=!e||e&&e.type==="orientationchange";if(u){u=!1;if(!t)return;if(!e||e.type!=="scroll"||n)t.autoSize&&t.type!=="iframe"&&(o.inner.height("auto"),t.height=o.inner.height()),(t.autoResize||n)&&o._setDimension(),t.canGrow&&t.type!=="iframe"&&o.inner.height("auto");(t.autoCenter||n)&&o.reposition(e),o.trigger("onUpdate")}},200)),u=!0},toggle:function(){o.isOpen&&(o.current.fitToView=!o.current.fitToView,o.update())},hideLoading:function(){s.unbind("keypress.fb"),n("#fancybox-loading").remove()},showLoading:function(){o.hideLoading(),s.bind("keypress.fb",function(e){e.keyCode===27&&(e.preventDefault(),o.cancel())}),n('<div id="fancybox-loading"><div></div></div>').click(o.cancel).appendTo("body")},getViewport:function(){return{x:i.scrollLeft(),y:i.scrollTop(),w:f&&e.innerWidth?e.innerWidth:i.width(),h:f&&e.innerHeight?e.innerHeight:i.height()}},unbindEvents:function(){o.wrap&&o.wrap.unbind(".fb"),s.unbind(".fb"),i.unbind(".fb")},bindEvents:function(){var e=o.current,t=e.keys;if(!e)return;i.bind("resize.fb orientationchange.fb"+(e.autoCenter&&!e.fixed?" scroll.fb":""),o.update),t&&s.bind("keydown.fb",function(e){var r,i=e.target||e.srcElement;!e.ctrlKey&&!e.altKey&&!e.shiftKey&&!e.metaKey&&(!i||!i.type&&!n(i).is("[contenteditable]"))&&(r=e.keyCode,n.inArray(r,t.close)>-1?(o.close(),e.preventDefault()):n.inArray(r,t.next)>-1?(o.next(),e.preventDefault()):n.inArray(r,t.prev)>-1&&(o.prev(),e.preventDefault()))}),n.fn.mousewheel&&e.mouseWheel&&o.group.length>1&&o.wrap.bind("mousewheel.fb",function(e,t){var n=e.target||null;t!==0&&(!n||n.clientHeight===0||n.scrollHeight===n.clientHeight&&n.scrollWidth===n.clientWidth)&&(e.preventDefault(),o[t>0?"prev":"next"]())})},trigger:function(e,t){var r,i=t||o[n.inArray(e,["onCancel","beforeLoad","afterLoad"])>-1?"coming":"current"];if(!i)return;n.isFunction(i[e])&&(r=i[e].apply(i,Array.prototype.slice.call(arguments,1)));if(r===!1)return!1;i.helpers&&n.each(i.helpers,function(t,r){r&&n.isPlainObject(o.helpers[t])&&n.isFunction(o.helpers[t][e])&&o.helpers[t][e](r,i)}),n.event.trigger(e+".fb")},isImage:function(e){return l(e)&&e.match(/\.(jpe?g|gif|png|bmp)((\?|#).*)?$/i)},isSWF:function(e){return l(e)&&e.match(/\.(swf)((\?|#).*)?$/i)},_start:function(e){var t={},r=o.group[e]||null,i,s,u,a,f;r&&(r.nodeType||r instanceof n)&&(i=!0,n.metadata&&(t=n(r).metadata())),t=n.extend(!0,{},o.opts,{index:e,element:r},n.isPlainObject(r)?r:t),n.each(["href","title","content","type"],function(e,s){t[s]=o.opts[s]||i&&n(r).attr(s)||t[s]||null}),typeof t.margin=="number"&&(t.margin=[t.margin,t.margin,t.margin,t.margin]),t.modal&&n.extend(!0,t,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{css:{cursor:"auto"},closeClick:!1}}}),o.coming=t;if(!1===o.trigger("beforeLoad")){o.coming=null;return}u=t.type,s=t.href||r,u||(i&&(u=n(r).data("fancybox-type"),u||(a=r.className.match(/fancybox\.(\w+)/),u=a?a[1]:null)),!u&&l(s)&&(o.isImage(s)?u="image":o.isSWF(s)?u="swf":s.match(/^#/)&&(u="inline")),u||(u=i?"inline":"html"),t.type=u);if(u==="inline"||u==="html"){t.content||(u==="inline"?t.content=n(l(s)?s.replace(/.*(?=#[^\s]+$)/,""):s):t.content=r);if(!t.content||!t.content.length)u=null}else s||(u=null);u==="ajax"&&l(s)&&(f=s.split(/\s+/,2),s=f.shift(),t.selector=f.shift()),t.href=s,t.group=o.group,t.isDom=i;switch(u){case"image":o._loadImage();break;case"ajax":o._loadAjax();break;case"inline":case"iframe":case"swf":case"html":o._afterLoad();break;default:o._error("type")}},_error:function(e){o.hideLoading(),n.extend(o.coming,{type:"html",autoSize:!0,minWidth:0,minHeight:0,padding:15,hasError:e,content:o.coming.tpl.error}),o._afterLoad()},_loadImage:function(){var e=o.imgPreload=new Image;e.onload=function(){this.onload=this.onerror=null,o.coming.width=this.width,o.coming.height=this.height,o._afterLoad()},e.onerror=function(){this.onload=this.onerror=null,o._error("image")},e.src=o.coming.href,(e.complete===r||!e.complete)&&o.showLoading()},_loadAjax:function(){o.showLoading(),o.ajaxLoad=n.ajax(n.extend({},o.coming.ajax,{url:o.coming.href,error:function(e,t){o.coming&&t!=="abort"?o._error("ajax",e):o.hideLoading()},success:function(e,t){t==="success"&&(o.coming.content=e,o._afterLoad())}}))},_preloadImages:function(){var e=o.group,t=o.current,r=e.length,i,s,u,a=Math.min(t.preload,r-1);if(!t.preload||e.length<2)return;for(u=1;u<=a;u+=1){i=e[(t.index+u)%r],s=i.href||n(i).attr("href")||i;if(i.type==="image"||o.isImage(s))(new Image).src=s}},_afterLoad:function(){o.hideLoading();if(!o.coming||!1===o.trigger("afterLoad",o.current)){o.coming=!1;return}o.isOpened?(n(".fancybox-item, .fancybox-nav").remove(),o.wrap.stop(!0).removeClass("fancybox-opened"),o.inner.css("overflow","hidden"),o.transitions[o.current.prevMethod]()):(n(".fancybox-wrap").stop().trigger("onReset").remove(),o.trigger("afterClose")),o.unbindEvents(),o.isOpen=!1,o.current=o.coming,o.wrap=n(o.current.tpl.wrap).addClass("fancybox-"+(f?"mobile":"desktop")+" fancybox-type-"+o.current.type+" fancybox-tmp "+o.current.wrapCSS).appendTo("body"),o.skin=n(".fancybox-skin",o.wrap).css("padding",h(o.current.padding)),o.outer=n(".fancybox-outer",o.wrap),o.inner=n(".fancybox-inner",o.wrap),o._setContent()},_setContent:function(){var e=o.current,t=e.content,r=e.type,i=e.minWidth,s=e.minHeight,u=e.maxWidth,a=e.maxHeight,l;switch(r){case"inline":case"ajax":case"html":e.selector?t=n("<div>").html(t).find(e.selector):t instanceof n&&(t.parent().hasClass("fancybox-inner")&&t.parents(".fancybox-wrap").unbind("onReset"),t=t.show().detach(),n(o.wrap).bind("onReset",function(){t.appendTo("body").hide()})),e.autoSize&&(l=n('<div class="fancybox-wrap '+o.current.wrapCSS+' fancybox-tmp"></div>').appendTo("body").css({minWidth:h(i,"w"),minHeight:h(s,"h"),maxWidth:h(u,"w"),maxHeight:h(a,"h")}).append(t),e.width=l.width(),e.height=l.height(),l.width(o.current.width),l.height()>e.height&&(l.width(e.width+1),e.width=l.width(),e.height=l.height()),t=l.contents().detach(),l.remove());break;case"image":t=e.tpl.image.replace("{href}",e.href),e.aspectRatio=!0;break;case"swf":t=e.tpl.swf.replace(/\{width\}/g,e.width).replace(/\{height\}/g,e.height).replace(/\{href\}/g,e.href);break;case"iframe":t=n(e.tpl.iframe.replace("{rnd}",(new Date).getTime())).attr("scrolling",e.scrolling).attr("src",e.href),e.scrolling=f?"scroll":"auto"}if(r==="image"||r==="swf")e.autoSize=!1,e.scrolling="visible";r==="iframe"&&e.autoSize?(o.showLoading(),o._setDimension(),o.inner.css("overflow",e.scrolling),t.bind({onCancel:function(){n(this).unbind(),o._afterZoomOut()},load:function(){o.hideLoading();try{this.contentWindow.document.location&&(o.current.height=n(this).contents().find("body").height())}catch(e){o.current.autoSize=!1}o[o.isOpen?"_afterZoomIn":"_beforeShow"]()}}).appendTo(o.inner)):(o.inner.append(t),o._beforeShow())},_beforeShow:function(){o.coming=null,o.trigger("beforeShow"),o._setDimension(),o.wrap.hide().removeClass("fancybox-tmp"),o.bindEvents(),o._preloadImages(),o.transitions[o.isOpened?o.current.nextMethod:o.current.openMethod]()},_setDimension:function(){var e=o.wrap,t=o.inner,r=o.current,i=o.getViewport(),s=r.margin,u=r.padding*2,a=r.width,f=r.height,l=r.maxWidth+u,p=r.maxHeight+u,d=r.minWidth+u,v=r.minHeight+u,m,g;i.w-=s[1]+s[3],i.h-=s[0]+s[2],c(a)&&(a=(i.w-u)*parseFloat(a)/100),c(f)&&(f=(i.h-u)*parseFloat(f)/100),m=a/f,a+=u,f+=u,r.fitToView&&(l=Math.min(i.w,l),p=Math.min(i.h,p)),r.aspectRatio?(a>l&&(a=l,f=(a-u)/m+u),f>p&&(f=p,a=(f-u)*m+u),a<d&&(a=d,f=(a-u)/m+u),f<v&&(f=v,a=(f-u)*m+u)):(a=Math.max(d,Math.min(a,l)),f=Math.max(v,Math.min(f,p))),a=Math.round(a),f=Math.round(f),n(e.add(t)).width("auto").height("auto"),t.width(a-u).height(f-u),e.width(a),g=e.height();if(a>l||g>p)while((a>l||g>p)&&a>d&&g>v)f-=10,r.aspectRatio?(a=Math.round((f-u)*m+u),a<d&&(a=d,f=(a-u)/m+u)):a-=10,t.width(a-u).height(f-u),e.width(a),g=e.height();r.dim={width:h(a),height:h(g)},r.canGrow=r.autoSize&&f>v&&f<p,r.canShrink=!1,r.canExpand=!1,a-u<r.width||f-u<r.height?r.canExpand=!0:(a>i.w||g>i.h)&&a>d&&f>v&&(r.canShrink=!0),o.innerSpace=g-u-t.height()},_getPosition:function(e){var t=o.current,n=o.getViewport(),r=t.margin,i=o.wrap.width()+r[1]+r[3],s=o.wrap.height()+r[0]+r[2],u={position:"absolute",top:r[0]+n.y,left:r[3]+n.x};return t.autoCenter&&t.fixed&&!e&&s<=n.h&&i<=n.w&&(u={position:"fixed",top:r[0],left:r[3]}),u.top=h(Math.max(u.top,u.top+(n.h-s)*t.topRatio)),u.left=h(Math.max(u.left,u.left+(n.w-i)*.5)),u},_afterZoomIn:function(){var e=o.current,t=e?e.scrolling:"no";if(!e)return;o.isOpen=o.isOpened=!0,o.wrap.addClass("fancybox-opened"),o.inner.css("overflow",t==="yes"?"scroll":t==="no"?"hidden":t),o.trigger("afterShow"),o.update(),(e.closeClick||e.nextClick)&&o.inner.css("cursor","pointer").bind("click.fb",function(t){!n(t.target).is("a")&&!n(t.target).parent().is("a")&&o[e.closeClick?"close":"next"]()}),e.closeBtn&&n(e.tpl.closeBtn).appendTo(o.skin).bind("click.fb",o.close),e.arrows&&o.group.length>1&&((e.loop||e.index>0)&&n(e.tpl.prev).appendTo(o.outer).bind("click.fb",o.prev),(e.loop||e.index<o.group.length-1)&&n(e.tpl.next).appendTo(o.outer).bind("click.fb",o.next)),o.opts.autoPlay&&!o.player.isActive&&(o.opts.autoPlay=!1,o.play())},_afterZoomOut:function(){var e=o.current;o.wrap.trigger("onReset").remove(),n.extend(o,{group:{},opts:{},current:null,isActive:!1,isOpened:!1,isOpen:!1,wrap:null,skin:null,outer:null,inner:null}),o.trigger("afterClose",e)}}),o.transitions={getOrigPosition:function(){var e=o.current,t=e.element,r=e.padding,i=n(e.orig),s={},u=50,a=50,f;return!i.length&&e.isDom&&n(t).is(":visible")&&(i=n(t).find("img:first"),i.length||(i=n(t))),i.length?(s=i.offset(),i.is("img")&&(u=i.outerWidth(),a=i.outerHeight())):(f=o.getViewport(),s.top=f.y+(f.h-a)*.5,s.left=f.x+(f.w-u)*.5),s={top:h(s.top-r),left:h(s.left-r),width:h(u+r*2),height:h(a+r*2)},s},step:function(e,t){var n=t.prop,r,i;if(n==="width"||n==="height")r=Math.ceil(e-o.current.padding*2),n==="height"&&(i=(e-t.start)/(t.end-t.start),t.start>t.end&&(i=1-i),r-=o.innerSpace*i),o.inner[n](r)},zoomIn:function(){var e=o.wrap,t=o.current,r=t.openEffect,i=r==="elastic",s=t.dim,u=n.extend({},s,o._getPosition(i)),a=n.extend({opacity:1},u);delete a.position,i?(u=this.getOrigPosition(),t.openOpacity&&(u.opacity=0),o.outer.add(o.inner).width("auto").height("auto")):r==="fade"&&(u.opacity=0),e.css(u).show().animate(a,{duration:r==="none"?0:t.openSpeed,easing:t.openEasing,step:i?this.step:null,complete:o._afterZoomIn})},zoomOut:function(){var e=o.wrap,t=o.current,n=t.openEffect,r=n==="elastic",i={opacity:0};r&&(e.css("position")==="fixed"&&e.css(o._getPosition(!0)),i=this.getOrigPosition(),t.closeOpacity&&(i.opacity=0)),e.animate(i,{duration:n==="none"?0:t.closeSpeed,easing:t.closeEasing,step:r?this.step:null,complete:o._afterZoomOut})},changeIn:function(){var e=o.wrap,t=o.current,n=t.nextEffect,r=n==="elastic",i=o._getPosition(r),s={opacity:1};i.opacity=0,r&&(i.top=h(parseInt(i.top,10)-200),s.top="+=200px"),e.css(i).show().animate(s,{duration:n==="none"?0:t.nextSpeed,easing:t.nextEasing,complete:o._afterZoomIn})},changeOut:function(){var e=o.wrap,t=o.current,r=t.prevEffect,i={opacity:0},s=function(){n(this).trigger("onReset").remove()};e.removeClass("fancybox-opened"),r==="elastic"&&(i.top="+=200px"),e.animate(i,{duration:r==="none"?0:t.prevSpeed,easing:t.prevEasing,complete:s})}},o.helpers.overlay={overlay:null,update:function(){var e,r,o;this.overlay.width("100%").height("100%"),n.browser.msie||f?(r=Math.max(t.documentElement.scrollWidth,t.body.scrollWidth),o=Math.max(t.documentElement.offsetWidth,t.body.offsetWidth),e=r<o?i.width():r):e=s.width(),this.overlay.width(e).height(s.height())},beforeShow:function(e){if(this.overlay)return;e=n.extend(!0,{},o.defaults.helpers.overlay,e),this.overlay=n('<div id="fancybox-overlay"></div>').css(e.css).appendTo("body"),e.closeClick&&this.overlay.bind("click.fb",o.close),o.current.fixed&&!f?this.overlay.addClass("overlay-fixed"):(this.update(),this.onUpdate=function(){this.update()}),this.overlay.fadeTo(e.speedIn,e.opacity)},afterClose:function(e){this.overlay&&this.overlay.fadeOut(e.speedOut||0,function(){n(this).remove()}),this.overlay=null}},o.helpers.title={beforeShow:function(e){var t,r=o.current.title;r&&(t=n('<div class="fancybox-title fancybox-title-'+e.type+'-wrap">'+r+"</div>").appendTo("body"),e.type==="float"&&(t.width(t.width()),t.wrapInner('<span class="child"></span>'),o.current.margin[2]+=Math.abs(parseInt(t.css("margin-bottom"),10))),t.appendTo(e.type==="over"?o.inner:e.type==="outside"?o.wrap:o.skin))}},n.fn.fancybox=function(e){var t=n(this),r=this.selector||"",i,u=function(s){var u=this,a=i,f,l;!(s.ctrlKey||s.altKey||s.shiftKey||s.metaKey)&&!n(u).is(".fancybox-wrap")&&(s.preventDefault(),f=e.groupAttr||"data-fancybox-group",l=n(u).attr(f),l||(f="rel",l=u[f]),l&&l!==""&&l!=="nofollow"&&(u=r.length?n(r):t,u=u.filter("["+f+'="'+l+'"]'),a=u.index(this)),e.index=a,o.open(u,e))};return e=e||{},i=e.index||0,r?s.undelegate(r,"click.fb-start").delegate(r,"click.fb-start",u):t.unbind("click.fb-start").bind("click.fb-start",u),this},n(t).ready(function(){o.defaults.fixed=n.support.fixedPosition||!(n.browser.msie&&n.browser.version<=6)&&!f})})(window,document,e)}),define("instance-admin/actions/person-add-remove",["jquery","instance-admin/app","instance-admin/models/person","instance-admin/views/person-new","instance-admin/views/person-remove","jquery.fancybox"],function(e,t,n,r,i){t.addInitializer(function(t){e("#new-person").click(function(t){t.preventDefault();var i=new n({}),s=new r({model:i});e.fancybox(s.render().el),s.$(":input:first").focus()}),e("a.delete-person").click(function(t){var r=e(this);t.preventDefault();var s=new n({id:r.attr("data-id")});s.fetch({success:function(t,n){var r=new i({model:t});e.fancybox(r.render().el)}})})})}),define("jqueryui/core",["jquery"],function(e){(function(e,t){function n(t,n){var i=t.nodeName.toLowerCase();if("area"===i){var s=t.parentNode,o=s.name,u;return!t.href||!o||s.nodeName.toLowerCase()!=="map"?!1:(u=e("img[usemap=#"+o+"]")[0],!!u&&r(u))}return(/input|select|textarea|button|object/.test(i)?!t.disabled:"a"==i?t.href||n:n)&&r(t)}function r(t){return!e(t).parents().andSelf().filter(function(){return e.curCSS(this,"visibility")==="hidden"||e.expr.filters.hidden(this)}).length}e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"@VERSION",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),e.fn.extend({propAttr:e.fn.prop||e.fn.attr,_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return e.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.curCSS(this,"position",1))&&/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.curCSS(this,"overflow",1)+e.curCSS(this,"overflow-y",1)+e.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.curCSS(t,"padding"+this,!0))||0,r&&(n-=parseFloat(e.curCSS(t,"border"+this+"Width",!0))||0),s&&(n-=parseFloat(e.curCSS(t,"margin"+this,!0))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var r=e.attr(t,"tabindex"),i=isNaN(r);return(i||r>=0)&&n(t,!i)}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));n.offsetHeight,e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=n.offsetHeight===100,e.support.selectstart="onselectstart"in n,t.removeChild(n).style.display="none"}),e.curCSS||(e.curCSS=e.css),e.extend(e.ui,{plugin:{add:function(t,n,r){var i=e.ui[t].prototype;for(var s in r)i.plugins[s]=i.plugins[s]||[],i.plugins[s].push([n,r[s]])},call:function(e,t,n){var r=e.plugins[t];if(!r||!e.element[0].parentNode)return;for(var i=0;i<r.length;i++)e.options[r[i][0]]&&r[i][1].apply(e.element,n)}},contains:function(e,t){return document.compareDocumentPosition?e.compareDocumentPosition(t)&16:e!==t&&e.contains(t)},hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}})})(e)}),define("jqueryui/widget",["jquery"],function(e){(function(e,t){if(e.cleanData){var n=e.cleanData;e.cleanData=function(t){for(var r=0,i;(i=t[r])!=null;r++)try{e(i).triggerHandler("remove")}catch(s){}n(t)}}else{var r=e.fn.remove;e.fn.remove=function(t,n){return this.each(function(){return n||(!t||e.filter(t,[this]).length)&&e("*",this).add([this]).each(function(){try{e(this).triggerHandler("remove")}catch(t){}}),r.call(e(this),t,n)})}}e.widget=function(t,n,r){var i=t.split(".")[0],s;t=t.split(".")[1],s=i+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][s]=function(n){return!!e.data(n,t)},e[i]=e[i]||{},e[i][t]=function(e,t){arguments.length&&this._createWidget(e,t)};var o=new n;o.options=e.extend(!0,{},o.options),e[i][t].prototype=e.extend(!0,o,{namespace:i,widgetName:t,widgetEventPrefix:e[i][t].prototype.widgetEventPrefix||t,widgetBaseClass:s},r),e.widget.bridge(t,e[i][t])},e.widget.bridge=function(n,r){e.fn[n]=function(i){var s=typeof i=="string",o=Array.prototype.slice.call(arguments,1),u=this;return i=!s&&o.length?e.extend.apply(null,[!0,i].concat(o)):i,s&&i.charAt(0)==="_"?u:(s?this.each(function(){var r=e.data(this,n),s=r&&e.isFunction(r[i])?r[i].apply(r,o):r;if(s!==r&&s!==t)return u=s,!1}):this.each(function(){var t=e.data(this,n);t?t.option(i||{})._init():e.data(this,n,new r(i,this))}),u)}},e.Widget=function(e,t){arguments.length&&this._createWidget(e,t)},e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(t,n){e.data(n,this.widgetName,this),this.element=e(n),this.options=e.extend(!0,{},this.options,this._getCreateOptions(),t);var r=this;this.element.bind("remove."+this.widgetName,function(){r.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(n,r){var i=n;if(arguments.length===0)return e.extend({},this.options);if(typeof n=="string"){if(r===t)return this.options[n];i={},i[n]=r}return this._setOptions(i),this},_setOptions:function(t){var n=this;return e.each(t,function(e,t){n._setOption(e,t)}),this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&this.widget()[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",t),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.call(this.element[0],n,r)===!1||n.isDefaultPrevented())}}})(e)}),define("jqueryui/position",["jquery"],function(e){(function(e,t){e.ui=e.ui||{};var n=/left|center|right/,r=/top|center|bottom/,i="center",s={},o=e.fn.position,u=e.fn.offset;e.fn.position=function(t){if(!t||!t.of)return o.apply(this,arguments);t=e.extend({},t);var u=e(t.of),a=u[0],f=(t.collision||"flip").split(" "),l=t.offset?t.offset.split(" "):[0,0],c,h,p;return a.nodeType===9?(c=u.width(),h=u.height(),p={top:0,left:0}):a.setTimeout?(c=u.width(),h=u.height(),p={top:u.scrollTop(),left:u.scrollLeft()}):a.preventDefault?(t.at="left top",c=h=0,p={top:t.of.pageY,left:t.of.pageX}):(c=u.outerWidth(),h=u.outerHeight(),p=u.offset()),e.each(["my","at"],function(){var e=(t[this]||"").split(" ");e.length===1&&(e=n.test(e[0])?e.concat([i]):r.test(e[0])?[i].concat(e):[i,i]),e[0]=n.test(e[0])?e[0]:i,e[1]=r.test(e[1])?e[1]:i,t[this]=e}),f.length===1&&(f[1]=f[0]),l[0]=parseInt(l[0],10)||0,l.length===1&&(l[1]=l[0]),l[1]=parseInt(l[1],10)||0,t.at[0]==="right"?p.left+=c:t.at[0]===i&&(p.left+=c/2),t.at[1]==="bottom"?p.top+=h:t.at[1]===i&&(p.top+=h/2),p.left+=l[0],p.top+=l[1],this.each(function(){var n=e(this),r=n.outerWidth(),o=n.outerHeight(),u=parseInt(e.curCSS(this,"marginLeft",!0))||0,a=parseInt(e.curCSS(this,"marginTop",!0))||0,d=r+u+(parseInt(e.curCSS(this,"marginRight",!0))||0),v=o+a+(parseInt(e.curCSS(this,"marginBottom",!0))||0),m=e.extend({},p),g;t.my[0]==="right"?m.left-=r:t.my[0]===i&&(m.left-=r/2),t.my[1]==="bottom"?m.top-=o:t.my[1]===i&&(m.top-=o/2),s.fractions||(m.left=Math.round(m.left),m.top=Math.round(m.top)),g={left:m.left-u,top:m.top-a},e.each(["left","top"],function(n,i){e.ui.position[f[n]]&&e.ui.position[f[n]][i](m,{targetWidth:c,targetHeight:h,elemWidth:r,elemHeight:o,collisionPosition:g,collisionWidth:d,collisionHeight:v,offset:l,my:t.my,at:t.at})}),e.fn.bgiframe&&n.bgiframe(),n.offset(e.extend(m,{using:t.using}))})},e.ui.position={fit:{left:function(t,n){var r=e(window),i=n.collisionPosition.left+n.collisionWidth-r.width()-r.scrollLeft();t.left=i>0?t.left-i:Math.max(t.left-n.collisionPosition.left,t.left)},top:function(t,n){var r=e(window),i=n.collisionPosition.top+n.collisionHeight-r.height()-r.scrollTop();t.top=i>0?t.top-i:Math.max(t.top-n.collisionPosition.top,t.top)}},flip:{left:function(t,n){if(n.at[0]===i)return;var r=e(window),s=n.collisionPosition.left+n.collisionWidth-r.width()-r.scrollLeft(),o=n.my[0]==="left"?-n.elemWidth:n.my[0]==="right"?n.elemWidth:0,u=n.at[0]==="left"?n.targetWidth:-n.targetWidth,a=-2*n.offset[0];t.left+=n.collisionPosition.left<0?o+u+a:s>0?o+u+a:0},top:function(t,n){if(n.at[1]===i)return;var r=e(window),s=n.collisionPosition.top+n.collisionHeight-r.height()-r.scrollTop(),o=n.my[1]==="top"?-n.elemHeight:n.my[1]==="bottom"?n.elemHeight:0,u=n.at[1]==="top"?n.targetHeight:-n.targetHeight,a=-2*n.offset[1];t.top+=n.collisionPosition.top<0?o+u+a:s>0?o+u+a:0}}},e.offset.setOffset||(e.offset.setOffset=function(t,n){/static/.test(e.curCSS(t,"position"))&&(t.style.position="relative");var r=e(t),i=r.offset(),s=parseInt(e.curCSS(t,"top",!0),10)||0,o=parseInt(e.curCSS(t,"left",!0),10)||0,u={top:n.top-i.top+s,left:n.left-i.left+o};"using"in n?n.using.call(t,u):r.css(u)},e.fn.offset=function(t){var n=this[0];return!n||!n.ownerDocument?null:t?e.isFunction(t)?this.each(function(n){e(this).offset(t.call(this,n,e(this).offset()))}):this.each(function(){e.offset.setOffset(this,t)}):u.call(this)}),function(){var t=document.getElementsByTagName("body")[0],n=document.createElement("div"),r,i,o,u,a;r=document.createElement(t?"div":"body"),o={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},t&&e.extend(o,{position:"absolute",left:"-1000px",top:"-1000px"});for(var f in o)r.style[f]=o[f];r.appendChild(n),i=t||document.documentElement,i.insertBefore(r,i.firstChild),n.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;",u=e(n).offset(function(e,t){return t}).offset(),r.innerHTML="",i.removeChild(r),a=u.top+u.left+(t?2e3:0),s.fractions=a>21&&a<22}()})(e)}),define("jqueryui/autocomplete",["jquery","./core","./widget","./position"],function(e){(function(e,t){var n=0;e.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var t=this,n=this.element[0].ownerDocument,r;this.isMultiLine=this.element.is("textarea"),this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(n){if(t.options.disabled||t.element.propAttr("readOnly"))return;r=!1;var i=e.ui.keyCode;switch(n.keyCode){case i.PAGE_UP:t._move("previousPage",n);break;case i.PAGE_DOWN:t._move("nextPage",n);break;case i.UP:t._keyEvent("previous",n);break;case i.DOWN:t._keyEvent("next",n);break;case i.ENTER:case i.NUMPAD_ENTER:t.menu.active&&(r=!0,n.preventDefault());case i.TAB:if(!t.menu.active)return;t.menu.select(n);break;case i.ESCAPE:t.element.val(t.term),t.close(n);break;default:clearTimeout(t.searching),t.searching=setTimeout(function(){t.term!=t.element.val()&&(t.selectedItem=null,t.search(null,n))},t.options.delay)}}).bind("keypress.autocomplete",function(e){r&&(r=!1,e.preventDefault())}).bind("focus.autocomplete",function(){if(t.options.disabled)return;t.selectedItem=null,t.previous=t.element.val()}).bind("blur.autocomplete",function(e){if(t.options.disabled)return;clearTimeout(t.searching),t.closing=setTimeout(function(){t.close(e),t._change(e)},150)}),this._initSource(),this.menu=e("<ul></ul>").addClass("ui-autocomplete").appendTo(e(this.options.appendTo||"body",n)[0]).mousedown(function(n){var r=t.menu.element[0];e(n.target).closest(".ui-menu-item").length||setTimeout(function(){e(document).one("mousedown",function(n){n.target!==t.element[0]&&n.target!==r&&!e.ui.contains(r,n.target)&&t.close()})},1),setTimeout(function(){clearTimeout(t.closing)},13)}).menu({focus:function(e,n){var r=n.item.data("item.autocomplete");!1!==t._trigger("focus",e,{item:r})&&/^key/.test(e.originalEvent.type)&&t.element.val(r.value)},selected:function(e,r){var i=r.item.data("item.autocomplete"),s=t.previous;t.element[0]!==n.activeElement&&(t.element.focus(),t.previous=s,setTimeout(function(){t.previous=s,t.selectedItem=i},1)),!1!==t._trigger("select",e,{item:i})&&t.element.val(i.value),t.term=t.element.val(),t.close(e),t.selectedItem=i},blur:function(e,n){t.menu.element.is(":visible")&&t.element.val()!==t.term&&t.element.val(t.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu"),e.fn.bgiframe&&this.menu.element.bgiframe(),t.beforeunloadHandler=function(){t.element.removeAttr("autocomplete")},e(window).bind("beforeunload",t.beforeunloadHandler)},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup"),this.menu.element.remove(),e(window).unbind("beforeunload",this.beforeunloadHandler),e.Widget.prototype.destroy.call(this)},_setOption:function(t,n){e.Widget.prototype._setOption.apply(this,arguments),t==="source"&&this._initSource(),t==="appendTo"&&this.menu.element.appendTo(e(n||"body",this.element[0].ownerDocument)[0]),t==="disabled"&&n&&this.xhr&&this.xhr.abort()},_initSource:function(){var t=this,n,r;e.isArray(this.options.source)?(n=this.options.source,this.source=function(t,r){r(e.ui.autocomplete.filter(n,t.term))}):typeof this.options.source=="string"?(r=this.options.source,this.source=function(n,i){t.xhr&&t.xhr.abort(),t.xhr=e.ajax({url:r,data:n,dataType:"json",success:function(e,t){i(e)},error:function(){i([])}})}):this.source=this.options.source},search:function(e,t){e=e!=null?e:this.element.val(),this.term=this.element.val();if(e.length<this.options.minLength)return this.close(t);clearTimeout(this.closing);if(this._trigger("search",t)===!1)return;return this._search(e)},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.source({term:e},this._response())},_response:function(){var e=this,t=++n;return function(r){t===n&&e.__response(r),e.pending--,e.pending||e.element.removeClass("ui-autocomplete-loading")}},__response:function(e){!this.options.disabled&&e&&e.length?(e=this._normalize(e),this._suggest(e),this._trigger("open")):this.close()},close:function(e){clearTimeout(this.closing),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.deactivate(),this._trigger("close",e))},_change:function(e){this.previous!==this.element.val()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return typeof t=="string"?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var n=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(n,t),this.menu.deactivate(),this.menu.refresh(),n.show(),this._resizeMenu(),n.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(new e.Event("mouseover"))},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,n){var r=this;e.each(n,function(e,n){r._renderItem(t,n)})},_renderItem:function(t,n){return e("<li></li>").data("item.autocomplete",n).append(e("<a></a>").text(n.label)).appendTo(t)},_move:function(e,t){if(!this.menu.element.is(":visible")){this.search(null,t);return}if(this.menu.first()&&/^previous/.test(e)||this.menu.last()&&/^next/.test(e)){this.element.val(this.term),this.menu.deactivate();return}this.menu[e](t)},widget:function(){return this.menu.element},_keyEvent:function(e,t){if(!this.isMultiLine||this.menu.element.is(":visible"))this._move(e,t),t.preventDefault()}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(t,n){var r=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(e){return r.test(e.label||e.value||e)})}})})(e),function(e){e.widget("ui.menu",{_create:function(){var t=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(n){if(!e(n.target).closest(".ui-menu-item a").length)return;n.preventDefault(),t.select(n)}),this.refresh()},refresh:function(){var t=this,n=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");n.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(n){t.activate(n,e(this).parent())}).mouseleave(function(){t.deactivate()})},activate:function(e,t){this.deactivate();if(this.hasScroll()){var n=t.offset().top-this.element.offset().top,r=this.element.scrollTop(),i=this.element.height();n<0?this.element.scrollTop(r+n):n>=i&&this.element.scrollTop(r+n-i+t.height())}this.active=t.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end(),this._trigger("focus",e,{item:t})},deactivate:function(){if(!this.active)return;this.active.children("a").removeClass("ui-state-hover").removeAttr("id"),this._trigger("blur"),this.active=null},next:function(e){this.move("next",".ui-menu-item:first",e)},previous:function(e){this.move("prev",".ui-menu-item:last",e)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(e,t,n){if(!this.active){this.activate(n,this.element.children(t));return}var r=this.active[e+"All"](".ui-menu-item").eq(0);r.length?this.activate(n,r):this.activate(n,this.element.children(t))},nextPage:function(t){if(this.hasScroll()){if(!this.active||this.last()){this.activate(t,this.element.children(".ui-menu-item:first"));return}var n=this.active.offset().top,r=this.element.height(),i=this.element.children(".ui-menu-item").filter(function(){var t=e(this).offset().top-n-r+e(this).height();return t<10&&t>-10});i.length||(i=this.element.children(".ui-menu-item:last")),this.activate(t,i)}else this.activate(t,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"))},previousPage:function(t){if(this.hasScroll()){if(!this.active||this.first()){this.activate(t,this.element.children(".ui-menu-item:last"));return}var n=this.active.offset().top,r=this.element.height(),i=this.element.children(".ui-menu-item").filter(function(){var t=e(this).offset().top-n+r-e(this).height();return t<10&&t>-10});i.length||(i=this.element.children(".ui-menu-item:first")),this.activate(t,i)}else this.activate(t,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element[e.fn.prop?"prop":"attr"]("scrollHeight")},select:function(e){this._trigger("selected",e,{item:this.active})}})}(e)}),define("instance-admin/views/list-item-edit",["jquery","underscore","Backbone","backbone-forms","underscore","instance-admin/views/submit-form-helper","jqueryui/autocomplete"],function(e,t,n,r,t,i){var s=n.View.extend({initialize:function(){this.model.on("change",this.render,this),this.form=new r({model:this.model})},render:function(){var n=this.model.schema,r=e(this.form.render().el);r.find("ul").append('<input type="submit" name="save" value="Save" />').append('<button name="delete">Delete</button>');var i=t.filter(t.keys(n),function(e){return n[e].autocomplete_source});return t.each(i,function(e){var t=n[e].autocomplete_source;r.find('input[name="'+e+'"]').autocomplete({source:t})}),this.$el.html(r),this},events:{"submit form ":"submitForm",'click button[name:"delete"]':"deleteEntry"},deleteEntry:function(e){e.preventDefault(),this.model.destroy(),this.remove()},submitForm:function(e){var t=this,n=function(e,n){var r={item:e.toJSON(),api_url_root:e.urlRoot};t.$el.html(t.template(r))},r=i({success_cb:n,view:t});r(e)}});return s}),define("instance-admin/actions/list-item-editor",["jquery","instance-admin/views/list-item-edit"],function(e,t){return function(n){var r=n.model,i=n.template;return function(n){var s=e(this),o=e(this).closest("li");n.preventDefault();var u=new r({}),a=s.attr("data-id");a&&(u.id=a),u.urlRoot=s.attr("data-url-root");var f=new t({model:u,el:o});f.template=i,u.isNew()?(o.after(o.clone()),f.render()):u.fetch()}}}),define("instance-admin/models/contact",["Backbone"],function(e){var t=e.Model.extend({idAttribute:"_id",schema:{kind:{dataType:"Text",validators:["required"],autocomplete_source:"/autocomplete/contact_kind"},value:{dataType:"Text",validators:["required"]}}});return t}),define("templates/contact/view",["jadeRuntime"],function(jade){return function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp,__indent=[];buf.push('<span class="admin-options"><a'),buf.push(attrs({"data-id":item.id||item._id,"data-url-root":api_url_root,"class":"edit contact-edit"},{"data-id":!0,"data-url-root":!0,"class":!0})),buf.push('><strong>^ edit</strong></a></span>\n<div class="list-item-title"> '+escape((interp=item.kind)==null?"":interp)+':</div>\n<div class="list-item-value">'+escape((interp=item.value)==null?"":interp)+"</div>")}return buf.join("")}}),define("instance-admin/actions/contact-edit",["jquery","instance-admin/app","instance-admin/actions/list-item-editor","instance-admin/models/contact","templates/contact/view"],function(e,t,n,r,i){t.addInitializer(function(t){e("#content").on("click","a.contact-edit",n({model:r,template:i}))})}),define("instance-admin/models/link",["Backbone"],function(e){return e.Model.extend({idAttribute:"_id",schema:{url:{dataType:"Text",validators:["required"]},comment:{dataType:"Text",validators:["required"],autocomplete_source:"/autocomplete/link_comment"}}})}),define("templates/link/view",["jadeRuntime"],function(jade){return function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp,__indent=[];buf.push('<span class="admin-options"><a'),buf.push(attrs({"data-id":item.id||item._id,"data-url-root":api_url_root,"class":"edit link-edit"},{"data-id":!0,"data-url-root":!0,"class":!0})),buf.push('><strong>^ edit</strong></a></span>\n<div class="list-item-title"> '+escape((interp=item.comment)==null?"":interp)+':</div>\n<div class="list-item-value">'+escape((interp=item.url)==null?"":interp)+"</div>")}return buf.join("")}}),define("instance-admin/actions/links-edit",["jquery","instance-admin/app","instance-admin/actions/list-item-editor","instance-admin/models/link","templates/link/view"],function(e,t,n,r,i){t.addInitializer(function(t){e("#content").on("click","a.link-edit",n({model:r,template:i}))})}),function(){function e(e){var t=e.currentTarget||e.srcElement,n;if(e.type==="load"||s.test(t.readyState)){e=t.getAttribute("data-requiremodule"),u[e]=!0;for(e=0;n=o[e];e++){if(!u[n.name])break;n.req([n.name],n.onLoad)}e>0&&o.splice(0,e),setTimeout(function(){t.parentNode.removeChild(t)},15)}}function t(e){var t,n;e.setAttribute("data-orderloaded","loaded");for(e=0;n=f[e];e++){if(!(t=a[n])||t.getAttribute("data-orderloaded")!=="loaded")break;delete a[n],require.addScriptToDom(t)}e>0&&f.splice(0,e)}var n=typeof document!="undefined"&&typeof window!="undefined"&&document.createElement("script"),r=n&&(n.async||window.opera&&Object.prototype.toString.call(window.opera)==="[object Opera]"||"MozAppearance"in document.documentElement.style),i=n&&n.readyState==="uninitialized",s=/^(complete|loaded)$/,o=[],u={},a={},f=[],n=null;define("order",{version:"1.0.5",load:function(n,s,u,l){var c;s.nameToUrl?(c=s.nameToUrl(n,null),require.s.skipAsync[c]=!0,r||l.isBuild?s([n],u):i?(l=require.s.contexts._,!l.urlFetched[c]&&!l.loaded[n]&&(l.urlFetched[c]=!0,require.resourcesReady(!1),l.scriptCount+=1,c=require.attach(c,l,n,null,null,t),a[n]=c,f.push(n)),s([n],u)):s.specified(n)?s([n],u):(o.push({name:n,req:s,onLoad:u}),require.attach(c,null,n,e,"script/cache"))):s([n],u)}})}(),require(["augmenters/mailchecker","augmenters/migration","augmenters/slug-validation","augmenters/edit-in-place"]),require(["instance-admin/app","instance-admin/actions/person-add-remove","instance-admin/actions/contact-edit","instance-admin/actions/links-edit"]),require(["order!jquery","instance-admin/app"],function(e,t){e.ajaxSetup({converters:{"text json":function(t){var n=e.parseJSON(t);return n.results||n.result||n}}}),e(function(){t.start()})}),define("run-instance-admin",function(){}),require(["require-config","run-instance-admin"]),define("main-instance-admin",function(){})